{% load i18n %}
{% load markup %}
{% load custom_tags %}

{% if manager.containers.images %}
    <div> 
        <input id="copyToClipboard" class="button" type="image" src="{% url webstatic "images/eclipse_copy_edit16.png" %}" alt="Copy to clipboard"> 
        <input id="unlink" class="button" type="image" src="{% url webstatic "images/cut16.png" %}" alt="Unlink" value="tann-{{ t.id }}">
        | <input id="addToBasket" class="button" type="image" src="{% url webstatic "images/basket16.png" %}" alt="Add to basket">
        | <a href="{% url load_metadata_details_multi %}" target="metadata_details"><img src="{% url webstatic "images/knotes16.png" %}" alt="a" title="annotation"/></a>
    </div>
    <div class="clear"> </div>

    <ul id="products">

    {% for t in manager.tags %}
        {% if t %}
            <li class="tagname"><h1>{{ t.textValue }}{% if t.description %} <span id="tagicons{{ t.id }}" title="<small>{{ t.description|default_if_none:"no description"|safe|linebreaks  }}</small>"><a><img src="{% url webstatic "images/info16.png" %}" alt="i" title="click to get metadata"/></a></span>{% endif %}</h1>
            </li>
            {% for c in manager.containers.images %}
                {% for ch in c.copyAnnotationLinks %}
                    {%ifequal ch.child.id.val t.id %}                                
                        <li class="product"><em>{{ c.name }}</em>
                            {% if c.isOwned %}<a href="{% if manager.project %}{% url load_data "project" manager.project.id "dataset" manager.dataset.id "image" c.id %}{% else %}{% if manager.dataset %}{% url load_data "dataset" manager.dataset.id "image" c.id %}{% else %}{% url load_data "image" c.id %}{% endif %}{% endif %}"><img id="{{ c.id }}" class="imgzoom" src="{% url render_thumbnail c.id %}" alt="image" title="{{ c.name }}"/></a>{% else %}<a href="{% if manager.project %}{% url load_data "project" manager.project.id "dataset" manager.dataset.id "image" c.id %}{% else %}{% if manager.dataset %}{% url load_data "dataset" manager.dataset.id "image" c.id %}{% else %}{% url load_data "image" c.id %}{% endif %}{% endif %}"><img id="{{ c.id }}" class="imgzoom" src="{% url render_thumbnail c.id %}" alt="image" title="{{ c.name }}"/></a>{% endif %}
                            <div class="center"><a href="{% url load_metadata_details "image" c.id %}" target="metadata_details"><img src="{% url webstatic "images/info12.png" %}" alt="info" title="info"/></a> {% if c.countAnnotations %} <img src="{% url webstatic "images/knotes12.png" %}" alt="a" title="annotation"/>[{{ c.countAnnotations }}]{% endif %}{% if not c.isOwned %} <img src="{% url webstatic "images/kgpg12.png" %}" alt="l" title="locked"/>{% endif %} <input type="checkbox" name="image" id="{{ c.id }}"></div>
                        </li>
                    {% endifequal %}
                {% endfor %}
            {% endfor %}

        {% endif %}
    {% endfor %}
    </ul>
    <div class="clear"> </div>
{% endif %}

<div class="separator30"> </div>

{% if manager.containers.projects or manager.containers.datasets or manager.containers.screens or manager.containers.plates %}
    <div> 
        <input id="copyToClipboard" class="button" type="image" src="{% url webstatic "images/eclipse_copy_edit16.png" %}" alt="Copy to clipboard"> 
        <input id="unlink" class="button" type="image" src="{% url webstatic "images/cut16.png" %}" alt="Unlink" value="tann-{{ t.id }}">
        | <input id="addToBasket" class="button" type="image" src="{% url webstatic "images/basket16.png" %}" alt="Add to basket">
        | <a href="{% url load_metadata_details_multi %}" target="metadata_details"><img src="{% url webstatic "images/knotes16.png" %}" alt="a" title="annotation"/></a>
    </div>
    <div class="clear"> </div>
    
    <table id="dataTable" class="tablesorter"> 
    <tbody>
    {% for t in manager.tags %}
    {% if t %}     
        <tr><td colspan="3"><h1>{{ t.textValue }}{% if t.description %} <span id="tagtables{{ t.id }}" title="<small>{{ t.description|default_if_none:"no description"|safe|linebreaks  }}</small>"><a><img src="{% url webstatic "images/info16.png" %}" alt="i" title="click to get metadata"/></a></span>{% endif %}</h1></td></tr>
        {% for c in manager.containers.projects %}
            {% for ch in c.copyAnnotationLinks %}
                {% ifequal ch.child.id.val t.id %}
                    <tr> 
                        <td class="product">{% if c.isOwned %}<a href="{% url load_data "project" c.id %}" title="{{ c.name }}"><img id="{{ c.id }}" src="{% url webstatic "images/folder32.png" %}" title="Project" alt="Project"/></a>{% else %}<a href="{% url load_data "project" c.id %}?filter=experimenter&experimenter={{ c.details.owner.id.val }}" title="{{ c.name }}"><img id="{{ c.id }}" src="{% url webstatic "images/folder32.png" %}" title="Project" alt="Project"/></a>{% endif %}</td> 
                        <td>{% if c.isOwned %}<a href="{% url load_data "project" c.id %}" title="{{ c.name }}" >{{ c.truncateNameForTree }}</a>{% else %}<a href="{% url load_data "project" c.id %}?filter=experimenter&experimenter={{ c.details.owner.id.val }}" title="{{ c.name }}" >{{ c.truncateNameForTree }}</a>{% endif %} <img alt="dataset" title="dataset" src="{% url webstatic "images/folder_image16.png" %}"/>[{{ c.countChildren }}]{% if not c.isOwned %} <img src="{% url webstatic "images/kgpg16.png" %}" alt="l" title="locked"/>{% endif %}{% if c.countAnnotations %} <img src="{% url webstatic "images/knotes16.png" %}" alt="a" title="annotation"/>[{{ c.countAnnotations }}]{% endif %} <a href="{% url load_metadata_details "project" c.id %}" target="metadata_details"><img src="{% url webstatic "images/info16.png" %}" alt="i" title="click to get metadata"/></a></td> 
                        <td><input type="checkbox" name="project" id="{{ c.id }}"></td>
                    </tr>
                {% endifequal %}
            {% endfor %}
        {% endfor %}

        {% for c in manager.containers.datasets %}
            {% for ch in c.copyAnnotationLinks %}
                {% ifequal ch.child.id.val t.id %}
                    <tr> 
                        <td class="product">{% if c.isOwned %}<a href="{% if manager.project %}{% url load_data "project" manager.project.id "dataset" c.id %}{% else %}{% url load_data "dataset" c.id %}{% endif %}" title="{{ c.name }}"><img id="{{ c.id }}" src="{% url webstatic "images/folder_image32.png" %}" title="Dataset" alt="Dataset"/></a>{% else %}<a href="{% if manager.project %}{% url load_data "project" manager.project.id "dataset" c.id %}{% else %}{% url load_data "dataset" c.id %}{% endif %}?filter=experimenter&experimenter={{ c.details.owner.id.val }}" title="{{ c.name }}"><img id="{{ c.id }}" src="{% url webstatic "images/folder_image32.png" %}" title="Dataset" alt="Dataset"/></a>{% endif %}</td> 
                        <td>{% if c.isOwned %}<a href="{% if manager.project %}{% url load_data "project" manager.project.id "dataset" c.id %}{% else %}{% url load_data "dataset" c.id %}{% endif %}" title="{{ c.name }}">{{ c.truncateNameForTree }}</a>{% else %}<a href="{% if manager.project %}{% url load_data "project" manager.project.id "dataset" c.id %}{% else %}{% url load_data "dataset" c.id %}{% endif %}?filter=experimenter&experimenter={{ c.details.owner.id.val }}" title="{{ c.name }}">{{ c.truncateNameForTree }}</a>{% endif %} <img src="{% url webstatic "images/image16.png" %}" title="image" alt="image"/>[{{ c.countChildren }}]{% if not c.isOwned %} <img src="{% url webstatic "images/kgpg16.png" %}" alt="l" title="locked"/>{% endif %}{% if c.countAnnotations %} <img src="{% url webstatic "images/knotes16.png" %}" alt="a" title="annotation"/>[{{ c.countAnnotations }}]{% endif %} <a href="{% url load_metadata_details "dataset" c.id %}" target="metadata_details"><img src="{% url webstatic "images/info16.png" %}" alt="i" title="click to get metadata"/></a></td> 
                        <td><input type="checkbox" name="dataset" id="{{ c.id }}"></td>
                    </tr>
                {% endifequal %}
            {% endfor %}
        {% endfor %}

        {% for c in manager.containers.screens %}
            {% for ch in c.copyAnnotationLinks %}
                {% ifequal ch.child.id.val t.id %}
                    <tr> 
                        <td class="product">{% if c.isOwned %}<a href="{% url load_data "screen" c.id %}"><img id="{{ c.id }}" src="{% url webstatic "images/folder_screen32.png" %}" title="{{ c.name }}" alt="screen"/></a>{% else %}<a href="{% url load_data "screen" c.id %}?filter=experimenter&experimenter={{ c.details.owner.id.val }}" title="{{ c.name }}"><img id="{{ c.id }}" src="{% url webstatic "images/folder_screen32.png" %}" title="{{ c.name }}" alt="project"/></a>{% endif %}</td> 
                        <td>{% if c.isOwned %}<a href="{% url load_data "screen" c.id %}">{{ c.truncateNameForTree }}</a>{% else %}<a href="{% url load_data "screen" c.id %}?filter=experimenter&experimenter={{ c.details.owner.id.val }}">{{ c.truncateNameForTree }}</a>{% endif %} <img alt="plate" title="plate" src="{% url webstatic "images/folder_plate16.png" %}"/>[{{ c.countChildren }}]{% if not c.isOwned %} <img src="{% url webstatic "images/kgpg16.png" %}" alt="l" title="locked"/>{% endif %}{% if c.countAnnotations %} <img src="{% url webstatic "images/knotes16.png" %}" alt="a" title="annotation"/>[{{ c.countAnnotations }}]{% endif %} <a href="{% url load_metadata_details "screen" c.id %}" target="metadata_details"><img src="{% url webstatic "images/info16.png" %}" alt="i" title="click to get metadata"/></a></td> 
                        <td><input type="checkbox" name="screen" id="{{ c.id }}"></td>
                    </tr>
                {% endifequal %}
            {% endfor %}
        {% endfor %}

        {% for c in manager.containers.plates %}
            {% for ch in c.copyAnnotationLinks %}
                {% ifequal ch.child.id.val t.id %}
                    <tr> 
                        <td class="product">{% if c.isOwned %}<a href="{% if manager.screen %}{% url load_data "screen" manager.screen.id "plate" c.id %}{% else %}{% url load_data "plate" c.id %}{% endif %}" title="{{ c.name }}"><img id="{{ c.id }}" src="{% url webstatic "images/folder_plate32.png" %}" title="{{ c.name }}" alt="project"/></a>{% else %}<a href="{% if manager.screen %}{% url load_data "screen" manager.screen.id "plate" c.id %}{% else %}{% url load_data "plate" c.id %}{% endif %}?filter=experimenter&experimenter={{ c.details.owner.id.val }}" title="{{ c.name }}"><img id="{{ c.id }}" src="{% url webstatic "images/folder_plate32.png" %}" title="{{ c.name }}" alt="screen"/></a>{% endif %}</td> 
                        <td>{% if c.isOwned %}<a href="{% if manager.screen %}{% url load_data "screen" manager.screen.id "plate" c.id %}{% else %}{% url load_data "plate" c.id %}{% endif %}">{{ c.truncateNameForTree }}</a>{% else %}<a href="{% if manager.screen %}{% url load_data "screen" manager.screen.id "plate" c.id %}{% else %}{% url load_data "plate" c.id %}{% endif %}?filter=experimenter&experimenter={{ c.details.owner.id.val }}">{{ c.truncateNameForTree }}</a>{% endif %} {% if not c.isOwned %} <img src="{% url webstatic "images/kgpg16.png" %}" alt="l" title="locked"/>{% endif %}{% if c.countAnnotations %} <img src="{% url webstatic "images/knotes16.png" %}" alt="a" title="annotation"/>[{{ c.countAnnotations }}]{% endif %} <a href="{% url load_metadata_details "plate" c.id %}" target="metadata_details"><img src="{% url webstatic "images/info16.png" %}" alt="i" title="click to get metadata"/></a></td> 
                        <td><input type="checkbox" name="plate" id="{{ c.id }}"></td>
                    </tr>
                {% endifequal %}
            {% endfor %}
        {% endfor %}
    
    {% endif %}
    {% endfor %}
    </tbody>
</table>
{% endif %}