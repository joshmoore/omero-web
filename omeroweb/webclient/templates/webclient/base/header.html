{% load i18n %}
{% load markup %}
{% load custom_tags %}

{% ifnotequal nav.menu "status" %}
<script>
    $(document).ready(function() {
        var i = setInterval(function (){
            $.getJSON("{% url progress %}", function(data) {
                if (data.inprogress==0) {
                    clearInterval(i);
                    $("#progress").hide();
                    if(data.failure>0) {
                        $("#jobstatus").html(data.failure + ' job(s) failed');
                    } else {
                        $("#jobstatus").html(data.jobs + ' job(s)');
                    } return;
                }

                $("#progress").show();
                $("#jobstatus").html(data.inprogress + ' job(s) in progress');
            });
        }, 2000);
    });
</script>
{% endifnotequal %}


<div id="path">
    
    <div id="actionWrapper">
        {% ifnotequal nav.menu "basket" %}
        <div id="baskets"><a href="{% url basket_action %}">{% trans "BASKET" %}</a> {% trans "contains" %} <span id="cartTotal">{{ nav.basket }}</span> {% plural nav.basket 'item' 'items' %}</div>
        {% endifnotequal %}
        {% ifnotequal nav.menu "status" %}
        <div id="queue"><a href="{% url status %}" class="align_left">STATUS:</a><div id="jobstatus"></div><img src="{% url webstatic "images/spinner.gif" %}" id="progress" style="display: none;"/></div>
        {% endifnotequal %}
    </div>
    
    <div id="logout">
        | {% for field in form_active_group %} {% trans "current group" %}: {{ field }} {% if field.errors %}{{ field.errors }}{% endif %}{% endfor %}
        | <a href="{% url weblogout %}">{% trans "logout" %}</a> |
    </div>
    
</div>

<div class="clear"> </div>