<ul class="header_toolbar">
    <li class="script_launch">
        <!-- Script launcher -->
        <span id="groupsUsersButton" class="toolbar_button" title="Switch Group/User"></span>
        <ul id="groupList" class="sub_menu dropdown">
            {% for grp in groups %}
                <li title="Click to switch Group" {% ifequal grp.id eContext.context.groupId %}class="current_group"{% endifequal %}>
                    <a href="{% url change_active_group %}?active_group={{grp.id}}&url=/webclient/userdata" class="switch_to_group">
                        <img
                        {% if grp.getDetails.getPermissions.isGroupWrite %} src="{% static "webclient/image/nuvola_ledorange16.png" %}"
                        {% else %}
                            {% if grp.details.permissions.isGroupRead %} src="{% static "webclient/image/nuvola_ledorange_readOnly16.png" %}"
                            {% else %}
                                src="{% static "webclient/image/nuvola_ledred16.png" %}"
                            {% endif %}
                        {% endif %} />
                        {{ grp.getName }}
                    </a>
                    <ul title="Switch to this Group and User">
                        {% if grp.leaders %}
                            <li>Leaders</li>
                            {% for user in grp.leaders %}
                                <li {% ifequal user.id experimenter %}class="current_user"{% endifequal %}>
                                    <!-- if this user is in current group, we just switch user -->
                                    {% ifequal grp.id eContext.context.groupId %}
                                    <a href="/webclient/userdata/?experimenter={{user.id}}">
                                    <!-- otherwise we switch group too -->
                                    {% else %}
                                    <a href="{% url change_active_group %}?active_group={{grp.id}}&url=/webclient/userdata/?experimenter={{user.id}}">
                                    {% endifequal %}
                                        {{ user.getFullName }}
                                    </a>
                                </li>
                            {% endfor %}
                        {% endif %}
                        
                        {% if grp.colleagues %}
                            <li>Members</li>
                            {% for user in grp.colleagues %}
                                <li {% ifequal user.id experimenter %}class="current_user"{% endifequal %}>
                                    {% ifequal grp.id eContext.context.groupId %}
                                    <a href="/webclient/userdata/?experimenter={{user.id}}">
                                    {% else %}
                                    <a href="{% url change_active_group %}?active_group={{grp.id}}&url=/webclient/userdata/?experimenter={{user.id}}">
                                    {% endifequal %}
                                        {{ user.getFullName }}
                                    </a>
                                </li>
                            {% endfor %}
                        {% endif %}
                    </ul>

                </li>
            {% endfor %}
        </ul>
    </li>
</ul>