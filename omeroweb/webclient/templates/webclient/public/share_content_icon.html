{% load i18n %}
{% load markup %}
{% load custom_tags %}
{% load wikitags %}
	
	<script type="text/javascript" src="{% url webstatic "javascript/ui/jquery.ui.selectable.js" %}"></script>
    
    <script type="text/javascript">
        $(document).ready(function(){

            var datatree = $.jstree._focused();

            // single click handler on image (container). Selection then update toolbar & metadata pane
            $("#dataIcons li").click(function(event) {
                handleClickSelection(event);
            });

            // handles selection for 'clicks' (not drags) including multi-select for shift and meta keys
            var handleClickSelection = function(event) {
                
                var $clickedImage = $(event.target);
                //var thumbs = $("#dataIcons img");
                //var selIndex = thumbs.index(event.target);
                
                var thumbs = $("#dataIcons img");
                var selIndex = thumbs.index(event.target);

                // regular click - remove selection
                //thumbs.parent().removeClass("ui-selected");
                //$("#dataIcons li input").each(function(){
                //    this.checked = false;
                //});
                // and select a single image
                //$clickedImage.parent().addClass("ui-selected");
                //primaryIndex = selIndex;
                datatree.deselect_all();
                thumbs.parent().removeClass("ui-selected");
                
                var branch = datatree._get_children('#'+$('#content_details').attr('rel'))
                var selectee = $(branch[selIndex]);
                $clickedImage.parent().addClass("ui-selected");
                if(!datatree.is_selected(selectee)) datatree.select_node(selectee);
                primaryIndex = selIndex;
            }

            // plugin to handle drag-select of images
            $("ul#dataIcons").selectable({
                filter: 'li',
                distance: 2,
                stop: function(){  
                },
                start: function(){
                }
            });
            
            

        });

    </script>

{% if share.imgSize %}

    <div id="toolbar" class="toolbar_noborder"></div>
    <div class="clear"> </div>
    
    <ul id="dataIcons">
        {% for c in share.imageInShare %}
        <li id="{{ c.id }}" title="{{ c.name }}" {% if not c.isOwned %}{% if eContext.isLeader %}class="editonly"{% else %}class="readonly"{% endif %}{% endif %}>
            {% if share.share.isOwned %}
            <img id="{{ c.id }}" src="{% url render_thumbnail c.id %}" alt="image" title="{{ c.name }}{% if not c.isOwned %}, owned by {{ c.getOwner.getNameWithInitial }}{% endif %}"/>
            {% else %}
            <img id="{{ c.id }}" src="{% url render_thumbnail c.id share.share.id %}" alt="image" title="{{ c.name }}{% if not c.isOwned %}, owned by {{ c.getOwner.getNameWithInitial }}{% endif %}"/>
            {% endif %}
        </li>
        {% endfor %}
    </ul>

{% else %}
    <p>{% trans "No data." %}</p>
{% endif %}


