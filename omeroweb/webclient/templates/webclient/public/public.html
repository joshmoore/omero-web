{% extends "webclient/base/base_container.html" %}
{% load i18n %}
{% load markup %}
{% load custom_tags %}
{% load wikitags %}

{% block link %}
    <link rel="stylesheet" href="{% url webstatic "css/container.css" %}" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% url webstatic "css/images.css" %}" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% url webstatic "css/tree.css" %}" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% url webstatic "css/table.css" %}" type="text/css" media="screen"/>
{% endblock %}

{% block jscript %}

    <script type="text/javascript" src="{% url webstatic "javascript/jquery.simple.tree.js" %}"></script>    
    

{% endblock %}

{% block script %}

    <script type="text/javascript" src="{% url webstatic "javascript/actions.js" %}"></script>
    
    <script type="text/javascript">
    var simpleTreeCollection;
        $(document).ready(function() 
            {
                var h = $(window).height()-200;
                $("div#tree_details").css('height', h);
                $("div#metadata_details").css('height', h+31);
                $("div#metadata_details iframe").attr('height', h+31);
                $("div#content_details").css('height', h+31);
                
                $("div#tree_details").html('<p>Loading imported images... please wait <img src="{% url webstatic "images/spinner.gif" %}"/></p>');
                $("div#tree_details").load("{% url load_public %}?view=tree", function() {
                    simpleTreeCollection = $('.simpleTree').simpleTree({
                        autoclose: false,
                        afterClick:function(node){
                            var obj = $(node).attr('id').split("-");
                            var par = $(node).parents('li:first').attr('id').split("-");
                            if (obj[0] == 'lock') {
                                $("div#buttons").html('<input class="button" type="image" src="{% url webstatic "images/reload16.png" %}" alt="Refresh" title="Refresh" onclick="document.location.href=\'{% url load_template nav.menu %}\'"/>');                             
                                $("#right_panel").show();
                                $("#swapMeta").html('<img tabindex="0" src="{% url webstatic "images/spacer.gif" %}" class="collapsed-right" id="lhid_trayhandle_icon_right">');
                                $("div#metadata_details").html('<iframe width="370" height="'+(h+31)+'" src="/webclient/metadata_details/share/'+obj[1]+'/" id="metadata_details" name="metadata_details"></iframe>');
                                $('iframe#metadata_details').load();
                                $("div#content_details").removeAttr('rel').children().remove(); 
                            } else if (obj[0] == 'sh') {
                                $("div#buttons").html('<input class="button" type="image" src="{% url webstatic "images/reload16.png" %}" alt="Refresh" title="Refresh" onclick="document.location.href=\'{% url load_template nav.menu %}\'"/>');                             
                                $("#right_panel").show();
                                $("#swapMeta").html('<img tabindex="0" src="{% url webstatic "images/spacer.gif" %}" class="collapsed-right" id="lhid_trayhandle_icon_right">');
                                $("div#metadata_details").html('<iframe width="370" height="'+(h+31)+'" src="/webclient/metadata_details/share/'+obj[1]+'/" id="metadata_details" name="metadata_details"></iframe>');
                                $('iframe#metadata_details').load();

                                if ($("div#content_details").attr('rel') != obj.join("-")) {
                                    $("div#content_details").html('<p>Loading data... please wait <img src ="{% url webstatic "images/spinner.gif" %}"/></p>');
                                    $("div#content_details").load('/webclient/load_public/'+obj[1]+'/?view=icon');
                                    $("div#content_details").attr('rel', obj.join("-"));
                                }
                            } else if (obj[0] == 'di') {
                                $("div#buttons").html('<input class="button" type="image" src="{% url webstatic "images/reload16.png" %}" alt="Refresh" title="Refresh" onclick="document.location.href=\'{% url load_template nav.menu %}\'"/>');
                                                                
                                $("#right_panel").show();
                                $("#swapMeta").html('<img tabindex="0" src="{% url webstatic "images/spacer.gif" %}" class="collapsed-right" id="lhid_trayhandle_icon_right">'); 
                                $("div#metadata_details").html('<iframe width="370" height="'+(h+31)+'" src="/webclient/metadata_details/discussion/'+obj[1]+'/" id="metadata_details" name="metadata_details"></iframe>');
                                $('iframe#metadata_details').load(); 
                                $("div#content_details").removeAttr('rel').children().remove(); 
                            } else if (obj[0] == 'img') {
                                var ro = $(node).children().filter('span').attr('id'); 
                                if (ro.indexOf('owner')>=0) {
                                    $("div#buttons").html('<input class="button" type="image" src="{% url webstatic "images/reload16.png" %}" alt="Refresh" title="Refresh" onclick="document.location.href=\'{% url load_template nav.menu %}\'"/> <a href="/webclient/action/removefromshare/share/'+par[1]+'/?source='+obj[0]+'-'+obj[1]+'&url={{ url }}" onClick="return confirm(\'Remove image?\');"><img src="{% url webstatic "images/cut16.png" %}" alt="r" title="remove"/></a>');
                                } else {
                                    $("div#buttons").html('<input class="button" type="image" src="{% url webstatic "images/reload16.png" %}" alt="Refresh" title="Refresh" onclick="document.location.href=\'{% url load_template nav.menu %}\'"/>');
                                }                                
                                
                                if ($("div#content_details").attr('rel') != par.join("-")) {
                                    $("div#content_details").html('<p>Loading data... please wait <img src ="{% url webstatic "images/spinner.gif" %}"/></p>');
                                    $("div#content_details").load('/webclient/load_public/'+par[1]+'/?view=icon');
                                    $("div#content_details").attr('rel', par.join("-"));
                                }
                                                            
                                $("#right_panel").show();
                                $("#swapMeta").html('<img tabindex="0" src="{% url webstatic "images/spacer.gif" %}" class="collapsed-right" id="lhid_trayhandle_icon_right">'); 
                                $("div#metadata_details").html('<iframe width="370" height="'+(h+31)+'" src="/webclient/metadata_details/image/'+obj[1]+'/'+par[1]+'/" id="metadata_details" name="metadata_details"></iframe>');
                                $('iframe#metadata_details').load();  
                            }                              
                        },
                        afterDblClick:function(node){                    
                        },
                        afterMove:function(destination, source, pos){
                        },
                        afterAjax:function(){
                        },
                        afterContextMenu:function(node){
                        },
                        animate:true
                        });
                });                
        }) 
        
    </script>
{% endblock %}

{% block left %}

    <div class="toolbar">
        <div id="buttons" class="align_left">
            <input class="button" type="image" src="{% url webstatic "images/reload16.png" %}" alt="Refresh" title="Refresh" onclick="document.location.href='{% url load_template nav.menu %}'"> <input class="button" type="image" src="{% url webstatic "images/wp_protocol16.png" %}" alt="Discuss" title="Discuss" onclick="makeDiscussion();"/>
        </div>
    </div>
    
</div>
<div class="clear"> </div>

<div id="tree_details"> </div>

{% endblock %}

{% block center %}

<!--<div id="content_action"></div>
<div class="clear"> </div>-->

<div id="content_details"> </div>

{% endblock %}


{% block right %}

<div id="metadata_details">
    <iframe width="370" name="metadata_details"></iframe>
</div>


{% endblock %}



