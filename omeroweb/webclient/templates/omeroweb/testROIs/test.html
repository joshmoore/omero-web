{% extends "omeroweb/base.html" %}
{% load i18n %}
{% load markup %}
{% load custom_tags %}

{% block link %}
    <link rel="stylesheet" href='{% url webstatic "css/myaccount.css" %}' type="text/css" media="screen"/>
{% endblock %}

{% block jscript %}
    <script type="text/javascript" src="{% url webstatic "javascript/jquery_1.2.6.js" %}"></script>
    <script type="text/javascript" src="{% url webstatic "javascript/jquery.svg.js" %}"></script>
    <script type="text/javascript" src="{% url webstatic "javascript/jquery.drawinglibrary.js" %}"></script>
    <script type="text/javascript" src="{% url webstatic "javascript/roi.js" %}"></script>
{% endblock %}

{% block script %}
    <script type="text/javascript" src="{% url webstatic "javascript/menu.js" %}"></script>
    
    <script type="text/javascript">
    function preview(img, selection) { 
    	$('#x1').val(selection.x1);
    	$('#y1').val(selection.y1);
    	$('#x2').val(selection.x2);
    	$('#y2').val(selection.y2);
    	$('#w').val(selection.width);
    	$('#h').val(selection.height);
    } 

    $(document).ready(function () { 
    	$('#save_thumb').click(function() {
    		var x1 = $('#x1').val();
    		var y1 = $('#y1').val();
    		var x2 = $('#x2').val();
    		var y2 = $('#y2').val();
    		var w = $('#w').val();
    		var h = $('#h').val();
    		if(x1=="" || y1=="" || x2=="" || y2=="" || w=="" || h==""){
    			alert("You must make a selection first");
    			return false;
    		}else{
    			return true;
    		}
    	});
    }); 

    $(window).load(function () { 
    	$('#thumbnail').imgAreaSelect({ 
    	    {% if params.x1 %}x1: {{ params.x1 }}, {% endif %}
    	    {% if params.x2 %}x2: {{ params.x2 }}, {% endif %}
    	    {% if params.y1 %}y1: {{ params.y1 }}, {% endif %}
    	    {% if params.y2 %}y2: {{ params.y2 }}, {% endif %}
    	    {% if params.shape %}selectionShape: '{{ params.shape }}',{% else %}selectionShape: 'rectangle',  {% endif %}
    	    outerOpacity: 0, selectionOpacity: 1, selectionColor: '', handles: true, onSelectChange: preview }); 
    });

    </script>
    
{% endblock %}

{% block path %}
    {{ path }}
{% endblock %}

{% block center %}
<div align="center">
	<img src="{% url myphoto %}" style="float: left; margin-right: 10px;" id="thumbnail" alt="Create Thumbnail" />
	<form action="{% url test %}"><ul>
	    <li>x1 <input name="x1" value="{% if params.x1 %}{{ params.x1 }}{% endif %}" id="x1" /></li>
		<li>y1 <input name="y1" value="{% if params.y1 %}{{ params.y1 }}{% endif %}" id="y1" /></li>
		<li>x2 <input name="x2" value="{% if params.x2 %}{{ params.x2 }}{% endif %}" id="x2" /></li>
		<li>y2 <input name="y2" value="{% if params.y2 %}{{ params.y2 }}{% endif %}" id="y2" /></li>
		<li>width <input name="w" value="{% if params.w %}{{ params.w }}{% endif %}" id="w" /></li>
		<li>height <input name="h" value="{% if params.h %}{{ params.h }}{% endif %}" id="h" /></li>
		<li>diagonal <input name="d" value="" id="d" /></li>
	</ul>
	<input type="submit" name="shape" value="elipse" id="elipse" />
	<input type="submit" name="shape" value="line" id="line" />
	<input type="submit" name="shape" value="rectangle" id="rectangle" /></form>
	Original size: ({{ photo_size.0.0 }}, {{ photo_size.0.1 }}) {{ photo_size.1|filesizeformat }}
    <ul>
</div>
{% endblock %}
