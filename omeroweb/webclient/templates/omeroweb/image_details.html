{% extends "omeroweb/base.html" %}
{% load markup %}
{% load custom_tags %}
{% load wikitags %}

{% block link %}
    <link rel="stylesheet" href="{% get_webclient_static_url %}/css/annotation.css" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% get_webclient_static_url %}/css/googiespell.css" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% get_webclient_static_url %}/css/tree.css" type="text/css" media="screen"/>
{% endblock %}

{% block jscript %}
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/jquery_1.2.6.js"></script>
    
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/ui/ui.core.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/ui/ui.accordion.js"></script>
    
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/googiespell/AJS.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/googiespell/googiespell.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/googiespell/cookiesupport.js"></script>
{% endblock %}

{% block script %}
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/menu.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/image.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/blitzcon.js"></script>
    
    <script>
        $(document).ready(function(){
            $("a.loadData").click(function()
            {
                $("div#hierarchy").html('<img src="{% get_webclient_static_url %}/images/tree/spinner.gif"/>');
                $("div#hierarchy").load("{% get_webclient_root_url %}/hierarchy/image/{{ manager.image.id }}/", 
                    function() {  
                        $("a.loadData").remove();                        
                    });
                return false; 
            });
            $("a.loadAnnotation").click(function()
            {
                $("div#annotation").html('<img src="{% get_webclient_static_url %}/images/tree/spinner.gif"/>');
                $("div#annotation").load("{% get_webclient_root_url %}/annotations/image/{{ manager.image.id }}/?url={{ url }}", function() {  
                        $("a.loadAnnotation").remove();                        
                    });
                return false; 
            });
        });
    </script>
    <script>
        $(document).ready(function(){
            $("#metadata").accordion( { 
                autoHeight: false,
                active: false,
                navigation: true, 
            });
        });
      </script>

{% endblock %}

{% block center %}

<div class="image">
    <h1>Image: {{ manager.image.name }} {% if manager.image.isEditable %}<a href="{% get_webclient_root_url %}/action/edit/image/{{ manager.image.id }}/?url={{url}}"><img src="{% get_webclient_static_url %}/images/color_line16.png" alt="e" title="edit"/></a>{% else %}<img src="{% get_webclient_static_url %}/images/kgpg16.png" alt="l" title="locked"/>{% endif %}</h1>
    {{ manager.image.description|default_if_none:"no description"|wikify|safe|linebreaks }}
</div>

{% if manager.image.isOwned %}
<div class="basket">
    <a href="#" onclick="toBasket('image', '{{ manager.image.id }}'); return false;">Add image to the basket <img src="{% get_webclient_static_url %}/images/basket12.png" alt="b" title="basket"/></a>
</div>
{% endif %}
<div class="clear"></div>

<div class="thumbnail">
    <a href="#" onclick="popup('','_blank','{{ manager.image.id }}'); return false;"><img class="imgzoom" src="{% get_webclient_root_url %}/render_thumbnail/details/{{ manager.image.id }}/" alt="image" title="{{ manager.image.name }}"/></a>
    
    <p>by {{ manager.image.getOwner }} ({{ manager.image.details.group.name.val }} {{ manager.image.details.permissions }})</p>
    
    <h1>More: </h1>
    <div><a href="#" class="loadData">Show the hierarchy structure.</a></div>
    <div id="hierarchy"> </div>
</div>

<div class="metadata"><h1>Metadata: </h1>

<ul id="metadata" class="ui-accordion-container" >
    <li><a href='#'>General:</a>
        <div>
            <p>Aquasition date: {{ manager.image.getAquaDate }}</p>
            <p>Image: X: {{ manager.image.getWidth }}px, Y: {{ manager.image.getHeight }}px, Z: {{ manager.image.z_count }}, T: {{ manager.image.t_count }}</p>
            <p>Pixel: X: {{ manager.image.getPixelSizeX|floatformat:4 }}&micro;m, Y: {{ manager.image.getPixelSizeY|floatformat:4 }}&micro;m, Z: {{ manager.image.getPixelSizeZ|floatformat:4 }}&micro;m)</p>
        </div>
    </li>
    <li><a href='#'>Objective:</a>
        <div>
            {% if form_objective %}
            <table class="forms">
                {% for field in form_objective %}
                <tr><td>{{ field.label_tag }}{% if field.field.required %}*{% endif %}</td>
                    <td>{{ field }}</td><td>{% if field.errors %}{{ field.errors }}{% endif %}<br/>{{ field.help_text }}</td>
                </tr>
                {% endfor %}
            </table>
            {% endif %}
        </div>
    </li>
    <li><a href='#'>Environment:</a>
        <div>
            {% if form_environment %}
            <table class="forms">
                {% for field in form_environment %}
                <tr><td>{{ field.label_tag }}{% if field.field.required %}*{% endif %}</td>
                    <td>{{ field }}</td><td>{% if field.errors %}{{ field.errors }}{% endif %}<br/>{{ field.help_text }}</td>
                </tr>
                {% endfor %}
            </table>
            {% endif %}
        </div>
    </li>
    <li><a href='#'>Position:</a>
        <div>
            <p>{{ manager.image.position }}</p>
        </div>
    </li>
</ul>

</div>
<div class="clear"></div>

<div><a href="#" class="loadAnnotation">Show annotations.</a></div>
{% endblock %}
