{% extends "omeroweb/base.html" %}
{% load markup %}
{% load custom_tags %}
{% load wikitags %}

{% block link %}
    <link rel="stylesheet" href="{% get_webclient_static_url %}/css/thickbox.css" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% get_webclient_static_url %}/css/annotation.css" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% get_webclient_static_url %}/css/table.css" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% get_webclient_static_url %}/css/tree.css" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% get_webclient_static_url %}/css/googiespell.css" type="text/css" media="screen"/>
{% endblock %}

{% block jscript %}
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/jquery_1.2.6.js"></script>
    
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/jquery.tablesorter.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/jquery.quicksearch.js"></script>
    
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/ui/ui.core.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/ui/ui.draggable.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/ui/ui.droppable.js"></script>
    
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/googiespell/AJS.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/googiespell/googiespell.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/googiespell/cookiesupport.js"></script>
    
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/thickbox/thickbox.js"></script>
{% endblock %}


{% block script %}
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/menu.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/basket.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/blitzcon.js"></script>
    
    <script type="text/javascript">
        $(document).ready(function() 
            { 
                $("#dataTable").tablesorter( {sortList: [[1,1]]} ); 
            
                $('table#dataTable tbody tr').quicksearch({
                    attached: "div#view",
                    position: "before",
                    stripeRowClass: null,
                    labelText: 'Filter:',
                    inputText: '...',
                    loaderImg: '{% get_webclient_static_url %}/images/tree/spinner.gif',
                });
                
                $("a.loadData").click(function()
                {
                    $("div#hierarchy").html('<img src="{% get_webclient_static_url %}/images/tree/spinner.gif"/>');
                    $("div#hierarchy").load(
                        {% if manager.project or manager.dataset %}
                            {% if manager.dataset %}
                                "{% get_webclient_root_url %}/hierarchy/dataset/{{ manager.dataset.id }}/", 
                            {% endif %}
                            {% if manager.project %}
                                "{% get_webclient_root_url %}/hierarchy/project/{{ manager.project.id }}/", 
                            {% endif %}
                        {% else %}
                            "{% get_webclient_root_url %}/hierarchy/", 
                        {% endif %}
                        function()  
                        {  
                            $("a.loadData").remove();                        
                        });
                    return false; 
                });
                $("a.loadAnnotation").click(function()
                {
                    $("div#annotation").html('<img src="{% get_webclient_static_url %}/images/tree/spinner.gif"/>');
                    {% if manager.dataset %}
                        $("div#annotation").load("{% get_webclient_root_url %}/annotations/dataset/{{ manager.dataset.id }}/", function() {  
                            $("a.loadAnnotation").remove();                        
                        });
                    {% else %}
                        {% if manager.project %}
                            $("div#annotation").load("{% get_webclient_root_url %}/annotations/project/{{ manager.project.id }}/", function() {  
                                $("a.loadAnnotation").remove();                        
                            });
                        {% endif %}
                    {% endif %}    
                    return false; 
                });
        })
    </script>
{% endblock %}

{% block center %}

{% if form_users %}
<div class="box">
    {% for field in form_users %}{{ field.label_tag }} {{ field }}{% if field.errors %} {{ field.errors }} {% endif %} {{ field.help_text }}{% endfor %}
</div>
{% endif %}

{% if form_mygroups %}
<div class="box">&nbsp;
    {% for field in form_mygroups %}{{ field.label_tag }} {{ field }}{% if field.errors %} {{ field.errors }} {% endif %} {{ field.help_text }}{% endfor %}
</div>
{% endif %}

<div class="clear"></div>

{% if manager.dataset %}
    <div class="dataset"><h1>Dataset: {{ manager.dataset.fullNameWrapped }} {% if not manager.dataset.isOwned %}<img src="{% get_webclient_static_url %}/images/kgpg16.png" alt="l" title="locked"/>{% endif %}</h1>
        {{ manager.dataset.description|default_if_none:"no description"|wikify|safe|linebreaks }}
    </div>
{% else %}
    {% if manager.project %}
        <div class="project"><h1>Project: {{ manager.project.fullNameWrapped }} {% if not manager.project.isOwned %}<img src="{% get_webclient_static_url %}/images/kgpg16.png" alt="l" title="locked"/>{% endif %}</h1>
            {{ manager.project.description|default_if_none:"no description"|wikify|safe|linebreaks }}
        </div>
    {% endif %}
{% endif %}
{% if manager.dataset %}
    <div class="toolbar">
        | {% if manager.dataset.isOwned %}Select <a href="#" onclick="toBasket('dataset', '{{ manager.dataset.id }}'); return false;"><img src="{% get_webclient_static_url %}/images/basket16.png" alt="b" title="add to basket"/></a> {% endif %}
        Copy <a href="#" onclick="copyToClipboard('dataset', '{{ manager.dataset.id }}'); return false;"><img src="{% get_webclient_static_url %}/images/eclipse_copy_edit16.png" alt="c" title="copy"/></a> 
        Paste <a href="#" onclick="pasteFromClipboard('dataset', '{{ manager.dataset.id }}', '{{ url }}'); return false;"><img src="{% get_webclient_static_url %}/images/eclipse_paste_edit16.png" alt="p" title="paste"/></a>
        {% if manager.dataset.isEditable %} | Edit <a href="{% get_webclient_root_url %}/action/edit/dataset/{{ manager.dataset.id }}/?url={{url}}"><img src="{% get_webclient_static_url %}/images/color_line16.png" alt="e" title="edit"/></a>{% endif %} |
    </div>
    <div class="separate70"></div>
{% else %}
    {% if manager.project %}
        <div class="toolbar">
            | {% if manager.project.isOwned %}Select <a href="#" onclick="toBasket('project', '{{ manager.project.id }}'); return false;"><img src="{% get_webclient_static_url %}/images/basket16.png" alt="b" title="add to basket"/></a>{% endif %} 
            Copy <a href="#" onclick="copyToClipboard('project', '{{ manager.project.id }}'); return false;"><img src="{% get_webclient_static_url %}/images/eclipse_copy_edit16.png" alt="c" title="copy"/></a> 
            Paste <a href="#" onclick="pasteFromClipboard('project', '{{ manager.project.id }}', '{{ url }}'); return false;"><img src="{% get_webclient_static_url %}/images/eclipse_paste_edit16.png" alt="p" title="paste"/></a>
            {% if manager.project.isEditable %} | Edit <a href="{% get_webclient_root_url %}/action/edit/project/{{ manager.project.id }}/?url={{url}}"><img src="{% get_webclient_static_url %}/images/color_line16.png" alt="e" title="edit"/></a>{% endif %} |
        </div>
        <div class="separate70"></div>
    {% endif %}
{% endif %}

{% if manager.c_size or manager.c_mg_size %}
    {% if manager.c_size %}
        {% if manager.experimenter %}
            <h1>{{ manager.experimenter.getFullName }}'s ({{ manager.c_size }} items):</h1>
        {% else %}
            <h1>My data ({{ manager.c_size }} items):</h1>
        {% endif %}
    {% endif %}
    {% if manager.c_mg_size %}
        {% if manager.myGroup %}
            <h1>{{ manager.myGroup.name }}'s data ({{ manager.c_mg_size }} items):</h1>
        {% endif %}
    {% endif %}
{% else %}
    {% ifequal nav.menu 'mydata' %}
        <h1>My data (no item):</h1>
    {% else %}
        <h1>Data (no item):</h1>
    {% endifequal %}
{% endif %}

<div id="view"> 
{% ifequal nav.whos "mydata" %}
        | View <a href="{% get_webclient_root_url %}/mydata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}{% if manager.dataset.id %}dataset/{{manager.dataset.id}}/{% endif %}?view=table"><img src="{% get_webclient_static_url %}/images/view_detailed16.png" alt="details" title="details"/></a> <a href="{% get_webclient_root_url %}/mydata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}{% if manager.dataset.id %}dataset/{{manager.dataset.id}}/{% endif %}?view=icon"><img src="{% get_webclient_static_url %}/images/view_icon16.png" alt="icon" title="icon"/></a> <a href="{% get_webclient_root_url %}/mydata/?view=tree"><img src="{% get_webclient_static_url %}/images/view_tree16.png" alt="tree" title="tree"/></a> |
{% else %}
    {% ifequal nav.whos "share" %} | View <a href="{% get_webclient_root_url %}/share/?view=table"><img src="{% get_webclient_static_url %}/images/view_detailed16.png" alt="table" title="table"/></a> <a href="{% get_webclient_root_url %}/share/?view=icon"><img src="{% get_webclient_static_url %}/images/view_icon16.png" alt="icon" title="icon"/></a> |
    {% endifequal %}
    {% ifequal nav.whos "userdata" %} | View <a href="{% get_webclient_root_url %}/userdata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}{% if manager.dataset.id %}dataset/{{manager.dataset.id}}/{% endif %}?view=table"><img src="{% get_webclient_static_url %}/images/view_detailed16.png" alt="details" title="details"/></a> <a href="{% get_webclient_root_url %}/userdata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}{% if manager.dataset.id %}dataset/{{manager.dataset.id}}/{% endif %}?view=icon"><img src="{% get_webclient_static_url %}/images/view_icon16.png" alt="icon" title="icon"/></a> <a href="{% get_webclient_root_url %}/userdata/?view=tree"><img src="{% get_webclient_static_url %}/images/view_tree16.png" alt="tree" title="tree"/></a> |
    {% endifequal %}
    {% ifequal nav.whos "groupdata" %} | View <a href="{% get_webclient_root_url %}/groupdata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}{% if manager.dataset.id %}dataset/{{manager.dataset.id}}/{% endif %}?view=table"><img src="{% get_webclient_static_url %}/images/view_detailed16.png" alt="details" title="details"/></a> <a href="{% get_webclient_root_url %}/groupdata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}{% if manager.dataset.id %}dataset/{{manager.dataset.id}}/{% endif %}?view=icon"><img src="{% get_webclient_static_url %}/images/view_icon16.png" alt="icon" title="icon"/></a> <a href="{% get_webclient_root_url %}/groupdata/?view=tree"><img src="{% get_webclient_static_url %}/images/view_tree16.png" alt="tree" title="tree"/></a> |
    {% endifequal %}
{% endifequal %}
{% if not manager.image %}
    {% if manager.project %}
        New <a href="{% get_webclient_root_url %}/action/new/project/{{ manager.project.id }}/?url={{url}}"><img src="{% get_webclient_static_url %}/images/window_new16.jpg" alt="new" title="new" /></a> | 
    {% else %}
        {% if not manager.dataset %}
            New <a href="{% get_webclient_root_url %}/action/new/?url={{url}}"><img src="{% get_webclient_static_url %}/images/window_new16.jpg" alt="new" title="new" /></a> | 
        {% endif %}
    {% endif %}
{% endif %}
</div>

<div class="clear"> </div>

{% if not manager.c_mg_size and not manager.c_size %}
    <h1>No data.</h1>
{% else %}
    
    {% if manager.c_size %}
    <div>
    <table id="dataTable" class="tablesorter"> 
    <thead> 
    <tr> 
        <th>Type</th> 
        <th>Name</th> 
        <th>Action</th> 
        <th>Created</th>
        <th>Tag</th> 
    </tr> 
    </thead> 
    <tbody> 
        {% for c in manager.containers.projects %}
        <tr> 
            <td class="product">{% if c.isOnwed %}<a href="{% get_webclient_root_url %}/mydata/project/{{ c.id }}/"><img id="{{ c.id }}" src="{% get_webclient_static_url %}/images/folder32.png" title="{{ c.name }}" alt="project"/></a>{% else %}<a href="{% get_webclient_root_url %}/userdata/project/{{ c.id }}/?filter=experimenter&experimenter={{ c.details.owner.id.val }}"><img id="{{ c.id }}" src="{% get_webclient_static_url %}/images/folder32.png" title="{{ c.name }}" alt="project"/></a>{% endif %}</td> 
            <td>{% if c.isOwned %}<a href="{% get_webclient_root_url %}/mydata/project/{{ c.id }}/">{{ c.shortName }}</a>{% else %}<a href="{% get_webclient_root_url %}/userdata/project/{{ c.id }}/?filter=experimenter&experimenter={{ c.details.owner.id.val }}">{{ c.shortName }}</a>{% endif %} <img src="{% get_webclient_static_url %}/images/folder_image16.png" title="image" alt="image"/>[{{ c.countChild }}]{% if not c.isOwned %} <img src="{% get_webclient_static_url %}/images/kgpg16.png" alt="l" title="locked"/>{% endif %}{% if c.countAnnotations %} <img src="{% get_webclient_static_url %}/images/knotes16.png" alt="a" title="annotation"/>[{{ c.countAnnotations }}]{% endif %}</td> 
            <td></td>
            <td>{{ c.creationEventDate }}</td>
            <td>{{ c.details.group.name.val }}</td> 
        </tr> 
        {% endfor %}
        {% for c in manager.containers.datasets %}
        <tr> 
            <td class="product">{% if c.isOwned %}<a href="{% get_webclient_root_url %}/mydata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}dataset/{{ c.id }}/"><img id="{{ c.id }}" src="{% get_webclient_static_url %}/images/folder_image32.png" title="{{ c.name }}" alt="project"/></a>{% else %}<a href="{% get_webclient_root_url %}/userdata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}dataset/{{ c.id }}/?filter=experimenter&experimenter={{ c.details.owner.id.val }}"><img id="{{ c.id }}" src="{% get_webclient_static_url %}/images/folder_image32.png" title="{{ c.name }}" alt="project"/></a>{% endif %}</td> 
            <td>{% if c.isOwned %}<a href="{% get_webclient_root_url %}/mydata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}dataset/{{ c.id }}/">{{ c.shortName }}</a>{% else %}<a href="{% get_webclient_root_url %}/userdata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}dataset/{{ c.id }}/?filter=experimenter&experimenter={{ c.details.owner.id.val }}">{{ c.shortName }}</a>{% endif %} <img src="{% get_webclient_static_url %}/images/image16.png" title="image" alt="image"/>[{{ c.countChild }}]{% if not c.isOwned %} <img src="{% get_webclient_static_url %}/images/kgpg16.png" alt="l" title="locked"/>{% endif %}{% if c.countAnnotations %} <img src="{% get_webclient_static_url %}/images/knotes16.png" alt="a" title="annotation"/>[{{ c.countAnnotations }}]{% endif %}</td> 
            <td><a href="#" onclick="copyToClipboard('dataset', '{{ c.id }}'); return false;"><img src="{% get_webclient_static_url %}/images/eclipse_copy_edit16.png" alt="c" title="copy"/></a>{% if manager.project and c.isOwned %} <a href="{% get_webclient_root_url %}/action/remove/?parent=pr-{{ manager.project.id }}&source=ds-{{ c.id }}&url={{ url }}"><img src="{% get_webclient_static_url %}/images/cut16.png" alt="u" title="unlink"/></a>{% endif %}</td>
            <td>{{ c.creationEventDate }}</td>
            <td>{{ c.details.group.name.val }}</td> 
        </tr> 
        {% endfor %}
        {% for c in manager.containers.images %}
        <tr> 
            <td class="product">{% if c.isOwned %}<a href="{% get_webclient_root_url %}/mydata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}{% if manager.dataset %}dataset/{{manager.dataset.id}}/{% endif %}image/{{ c.id }}/"><img id="{{ c.id }}" src="{% get_webclient_static_url %}/images/image32.png" title="{{ c.name }}" alt="image"/></a>{% else %}<a href="{% get_webclient_root_url %}/mydata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}{% if manager.dataset %}dataset/{{manager.dataset.id}}/{% endif %}image/{{ c.id }}/"><img id="{{ c.id }}" src="{% get_webclient_static_url %}/images/image32.png" title="{{ c.name }}" alt="image"/></a>{% endif %}</td> 
            <td>{% if c.isOwned %}<a href="{% get_webclient_root_url %}/mydata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}{% if manager.dataset %}dataset/{{manager.dataset.id}}/{% endif %}image/{{ c.id }}/">{{ c.shortName }}</a> {% else %}<a href="{% get_webclient_root_url %}/userdata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}{% if manager.dataset %}dataset/{{manager.dataset.id}}/{% endif %}image/{{ c.id }}/">{{ c.shortName }}</a>{% endif %}{% if not c.isOwned %} <img src="{% get_webclient_static_url %}/images/kgpg16.png" alt="l" title="locked"/>{% endif %}{% if c.countAnnotations %} <img src="{% get_webclient_static_url %}/images/knotes16.png" alt="a" title="annotation"/>[{{ c.countAnnotations }}]{% endif %}</td> 
            <td><a href="#" onclick="popup('','_blank','{{ c.id }}'); return false;"><img src="{% get_webclient_static_url %}/images/kview16.png" title="{{ c.name }}" alt="image"/></a> <a href="{% get_webclient_root_url %}/image_zoom/{{ c.id }}/?keepThis=true&TB_iframe=true&height=500&width=860" alt="{{ c.name }}" class="thickbox" rel="gallery-omero" title="{{ c.shortName }} by {{ c.getOwner }} ({{ c.details.group.name.val }} {{ c.details.permissions }})"><img src="{% get_webclient_static_url %}/images/kpresenter16.png" alt="p" title="presentation"/></a>{% if c.isOwned %} <a href="#" onclick="toBasket('image', '{{ c.id }}'); return false;"><img src="{% get_webclient_static_url %}/images/basket16.png" alt="b" title="basket"/></a>{% endif %} <a href="#" onclick="copyToClipboard('image', '{{ c.id }}'); return false;"><img src="{% get_webclient_static_url %}/images/eclipse_copy_edit16.png" alt="c" title="copy"/></a>{% if manager.dataset and c.isOwned %} <a href="{% get_webclient_root_url %}/action/remove/?parent=ds-{{ manager.dataset.id }}&source=img-{{ c.id }}&url={{ url }}"><img src="{% get_webclient_static_url %}/images/cut16.png" alt="u" title="unlink"/></a>{% endif %}</td>
            <td>{{ c.creationEventDate }}</td>
            <td>{{ c.details.group.name.val }}</td>
        </tr> 
        {% endfor %}
        
        {% if not manager.project and not manager.dataset %}
        {% if not manager.orphaned %}
        <tr> 
            <td class="product"><a href="{% get_webclient_root_url %}/{% ifequal nav.whos "mydata" %}mydata{% else %}userdata{% endifequal %}/orphaned/"><img src="{% get_webclient_static_url %}/images/folder_yellow32.png" title="Orphaned images" alt="Orphaned images"/></a></td> 
            <td><a href="{% get_webclient_root_url %}/{% ifequal nav.whos "mydata" %}mydata{% else %}userdata{% endifequal %}/orphaned/">Orphaned images</a></td> 
            <td></td> 
            <td></td>
            <td></td> 
        </tr>
        {% endif %}
        {% endif %}
    </tbody> 
    </table>
    </div>
    {% endif %}

    {% if manager.c_mg_size %}

    <table id="dataTable" class="tablesorter"> 
    <thead> 
    <tr> 
        <th>Type</th> 
        <th>Name</th> 
        <th>Action</th> 
        <th>Created</th>
        <th>Tag</th>
    </tr> 
    </thead> 
    <tbody>
        {% for k,v in manager.containersMyGroups.iteritems %}
            {% for c in v.projects %}
            <tr> 
                <td class="product"><a href="{% get_webclient_root_url %}/groupdata/project/{{ c.id }}/?filter=group&group={{ c.details.group.id.val }}"><img id="{{ c.id }}" src="{% get_webclient_static_url %}/images/folder32.png" title="{{ c.name }}" alt="project"/></a></td> 
                <td><a href="{% get_webclient_root_url %}/groupdata/project/{{ c.id }}/?filter=group&group={{ c.details.group.id.val }}">{{ c.shortName }}</a> <img src="{% get_webclient_static_url %}/images/folder_image16.png" title="image" alt="image"/>[{{ c.countChild }}]{% if not c.isOwned %} <img src="{% get_webclient_static_url %}/images/kgpg16.png" alt="l" title="locked"/>{% endif %}{% if c.countAnnotations %} <img src="{% get_webclient_static_url %}/images/knotes16.png" alt="a" title="annotation"/>[{{ c.countAnnotations }}]{% endif %}</td>
                <td></td> 
                <td>{{ c.creationEventDate }} by {{ c.getOwner }}</td>
                <td>{{ c.details.group.name.val }}</td> 
            </tr>
            {% endfor %}
            {% for c in v.datasets %}
            <tr> 
                <td class="product"><a href="{% get_webclient_root_url %}/groupdata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}dataset/{{ c.id }}/?filter=group&group={{ c.details.group.id.val }}"><img id="{{ c.id }}" src="{% get_webclient_static_url %}/images/folder_image32.png" title="{{ c.name }}" alt="project"/></a></td> 
                <td><a href="{% get_webclient_root_url %}/groupdata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}dataset/{{ c.id }}/?filter=group&group={{ c.details.group.id.val }}">{{ c.shortName }}</a> <img src="{% get_webclient_static_url %}/images/image16.png" title="image" alt="image"/>[{{ c.countChild }}]{% if not c.isOwned %}  <img src="{% get_webclient_static_url %}/images/kgpg16.png" alt="l" title="locked"/>{% endif %}{% if c.countAnnotations %} <img src="{% get_webclient_static_url %}/images/knotes16.png" alt="a" title="annotation"/>[{{ c.countAnnotations }}]{% endif %}</td> 
                <td><a href="#" onclick="copyToClipboard('dataset', '{{ c.id }}'); return false;"><img src="{% get_webclient_static_url %}/images/eclipse_copy_edit16.png" alt="c" title="copy"/></a>{% if manager.project and c.isOwned %} <a href="{% get_webclient_root_url %}/action/remove/?parent=pr-{{ manager.project.id }}&source=ds-{{ c.id }}&url={{ url }}"><img src="{% get_webclient_static_url %}/images/cut16.png" alt="u" title="unlink"/></a>{% endif %}</td>
                <td>{{ c.creationEventDate }} by {{ c.getOwner }}</td>
                <td>{{ c.details.group.name.val }}</td> 
            </tr>
            {% endfor %}
            {% for c in v.images %}
            <tr> 
                <td class="product"><a href="{% get_webclient_root_url %}/groupdata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}{% if manager.dataset %}dataset/{{manager.dataset.id}}/{% endif %}image/{{ c.id }}/"><img id="{{ c.id }}" src="{% get_webclient_static_url %}/images/image32.png" title="{{ c.name }}" alt="image"/></a></td> 
                <td><a href="{% get_webclient_root_url %}/groupdata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}{% if manager.dataset %}dataset/{{manager.dataset.id}}/{% endif %}image/{{ c.id }}/">{{ c.shortName }}</a>{% if not c.isOwned %}  <img src="{% get_webclient_static_url %}/images/kgpg16.png" alt="l" title="locked"/>{% endif %}{% if c.countAnnotations %} <img src="{% get_webclient_static_url %}/images/knotes16.png" alt="a" title="annotation"/>[{{ c.countAnnotations }}]{% endif %}</td> 
                <td><a href="#" onclick="popup('','_blank','{{ c.id }}'); return false;"><img src="{% get_webclient_static_url %}/images/kview16.png" title="{{ c.name }}" alt="image"/></a> <a href="{% get_webclient_root_url %}/image_zoom/{{ c.id }}/?keepThis=true&TB_iframe=true&height=500&width=860" alt="{{ c.name }}" class="thickbox" rel="gallery-omero" title="{{ c.shortName }} by {{ c.getOwner }} ({{ c.details.group.name.val }} {{ c.details.permissions }})"><img src="{% get_webclient_static_url %}/images/kpresenter16.png" alt="p" title="presentation"/></a>{% if c.isOwned %} <a href="#" onclick="toBasket('image', '{{ c.id }}'); return false;"><img src="{% get_webclient_static_url %}/images/basket16.png" alt="b" title="basket"/></a>{% endif %} <a href="#" onclick="copyToClipboard('image', '{{ c.id }}'); return false;"><img src="{% get_webclient_static_url %}/images/eclipse_copy_edit16.png" alt="c" title="copy"/></a>{% if manager.dataset and c.isOwned %} <a href="{% get_webclient_root_url %}/action/remove/?parent=ds-{{ manager.dataset.id }}&source=img-{{ c.id }}&url={{ url }}"><img src="{% get_webclient_static_url %}/images/cut16.png" alt="u" title="unlink"/></a>{% endif %}</td>
                <td>{{ c.creationEventDate }} by {{ c.getOwner }}</td>
                <td>{{ c.details.group.name.val }}</td>
            </tr>
            {% endfor %}
        {% endfor %}
        {% if not manager.project and not manager.dataset %}
        {% ifequal nav.whos "groupdata" %}
        {% if not manager.orphaned %}
        <tr> 
            <td class="product"><a href="{% get_webclient_root_url %}/groupdata/orphaned/"><img src="{% get_webclient_static_url %}/images/folder_yellow32.png" title="Orphaned images" alt="Orphaned images"/></a></td> 
            <td><a href="{% get_webclient_root_url %}/groupdata/orphaned/">Orphaned images</a></td> 
            <td></td> 
            <td></td>
            <td></td> 
        </tr>
        {% endif %}
        {% endifequal %}
        {% endif %}
    </tbody> 
    </table>
    {% endif %}

{% endif %}

<div class="separate70"></div>

{% if manager.project or manager.dataset %}

{% if manager.dataset.countAnnotations %}<div id="annotation"><a href="#" class="loadAnnotation">Show annotations associated with... [{{ manager.dataset.countAnnotations }}]</a></div>
{% else %}
    {% if manager.project.countAnnotations %}<div id="annotation"><a href="#" class="loadAnnotation">Show annotations associated with... [{{ manager.project.countAnnotations }}]</a></div>{% endif %}
{% endif %}

<div id="annotation_form">
    {% if form_comment %}
    <div class="comment">
        <h1>Add new comment:</h1>
        <form action="" method="post"><input type="hidden" name="action" value="comment" />
        <table>
            {% for field in form_comment %}
                <tr>
                    <td>{{ field }}</td><td>{% if field.errors %}{{ field.errors }}{% endif %}<br/>{{ field.help_text }}</td>
                </tr>
            {% endfor %}
                <tr><td colspan="2"><input type="submit" value="Save" /></td></tr>
            </table>
        </form>
        <script type="text/javascript">
            var googie_spell = new GoogieSpell("static_core/googiespell/", "/webclient/spellchecker/?lang=");
            googie_spell.decorateTextarea("id_content", null, "600px");
        </script>
    </div>
    {% endif %}

    {% if form_url %}
    <div class="url">
        <h1>Add new url:</h1>
        <form action="" method="post"><input type="hidden" name="action" value="url" />
        <table>
            {% for field in form_url %}
                <tr>
                    <td>{{ field }}</td><td>{% if field.errors %}{{ field.errors }}{% endif %}<br/>{{ field.help_text }}</td>
                </tr>
            {% endfor %}
                <tr><td colspan="2"><input type="submit" value="Save" /></td></tr>
            </table>
        </form>
    </div>
    {% endif %}

    {% if form_file %}
    <div class="file">
        <h1>Upload a file</h1>
        <form action="" method="post"><input type="hidden" name="action" value="file" />
        <table>
        {% for field in form_file %}
            <tr>
                <td>{{ field }}</td><td>{% if field.errors %}{{ field.errors }}{% endif %}<br/>{{ field.help_text }}</td>
            </tr>
        {% endfor %}
        </table>
        <input type="submit" value="Upload" />
        </form>
    </div>
    {% endif %}
</div>

<div class="clear"> </div>

<div>
    {% if manager.dataset %}
        <h1>Where this dataset is linked?</h1>
    {% else %}
        {% if manager.project %}<h1>Where this project is linked?</h1>{% endif %}
    {% endif %}
    <a href="#" class="loadData">Show the hierarchy structure...</a></div>
<div id="hierarchy"> </div>

{% endif %}
{% endblock %}

{% block advice %}
    {% include "omeroweb/advice.html" %}
{% endblock %}