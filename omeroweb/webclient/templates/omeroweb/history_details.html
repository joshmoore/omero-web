{% load i18n %}
{% load markup %}
{% load custom_tags %}
{% load wikitags %}

    <script type="text/javascript" src="{% url webstatic "javascript/ui/ui.selectable.js" %}"></script>
    
    <script type="text/javascript" src="{% url webstatic "javascript/jquery.tablesorter.js" %}"></script>
    <script type="text/javascript" src="{% url webstatic "javascript/jquery.quicksearch.js" %}"></script>
    
    <script type="text/javascript">
        $(document).ready(function(){

            $("table#dataTable tbody").selectable({
            	stop: function(){
            		var result = $("#select-result").empty();
            		var l = $('tr.ui-selected', this).length;
            		$("tr.ui-selected td input", this).each(function(){
            		    this.checked = true;
            		});
            		if (l == 1) {
            		    $("#toolbar").html("");
            		    $("#right_panel").show();
                        $("#swapMeta").html('<img tabindex="0" src="{% url webstatic "images/tree/spacer.gif" %}" class="collapsed-right" id="lhid_trayhandle_icon_right">'); 
            		    $('tr.ui-selected', this).each(function(){  
            		        var h = $(window).height()-169;
            		        var obj = this.id.split("-");
            		        $("div#metadata_details").html('<iframe width="100%" height="'+h+'" src="/webclient/metadata_details/'+obj[0]+'/'+obj[1]+'/" id="metadata_details" name="metadata_details"></iframe>');
                            $('iframe#metadata_details').load();
                        });
            		} else {
            		    $("#toolbar").html('<a href="{% url load_metadata_details_multi %}" target="metadata_details"><img src="{% url webstatic "images/knotes16.png" %}" alt="a" title="annotation"/></a>');
            		    $("#right_panel").show();
            		    $("#swapMeta").html('<img tabindex="0" src="{% url webstatic "images/tree/spacer.gif" %}" class="collapsed-right" id="lhid_trayhandle_icon_right">'); 
            		    $("div#metadata_details").html('<p>'+ l +' elements selected.</p>');
            		}
            	},
            	start: function(){
            		$("tr td input", this).each(function(){
            			this.checked = false;
            		});
            	}
            });
            
            $("#dataTable").tablesorter( {sortList: [[1,0]]} ); 

            $('input#id_search').quicksearch('table#dataTable tbody tr', {
            	'delay': 300,
                'loader': 'span.loading'
            });
        });
    </script>
    
    <h1 id="data">{{ eContext.breadcrumb.2 }} {{ eContext.breadcrumb.1 }}</a> {% if controller.day_items_size %}{{ controller.total_items_size }} item(s){% endif %}</h1>
    
    <div id="toolbar" class="toolbar_noborder"></div>
    <div class="clear"> </div>

    <div>
        {% if controller.day_items_size %}
        
        <form class="quicksearch" id="quicksearch" action="#"><label for="id_search">Filter:</label> <input type="text" id="id_search" value="search"> <span class="loading"><img class="loader" alt="Loading" src="{% url wastatic "images/spinner.gif" %}"></span></form>
        
        <table id="dataTable" class="tablesorter">
            <thead> 
                <tr> 
                    <th>{% trans "Image" %}</th> 
                    <th>{% trans "Name" %}</th> 
                    <th>{% trans "Date" %}</th> 
                </tr> 
            </thead>
            <tbody>
            {% for i in controller.day_items %}
            {% for c in i.project %}
                <tr id="project-{{ c.id }}">
                    <td class="action">
                        <img id="{{ c.id }}" src="{% url webstatic "images/folder32.png" %}" alt="project" title="{{ c.name }}"/>
                        <input type="checkbox" name="project" id="{{ c.id }}">      
                    </td>
                    <td class="desc">{{ c.shortName2 }} {% if c.annotation_counter %}<img src="{% url webstatic "images/knotes16.png" %}" alt="a" title="annotation"/>{% endif %}{% if not c.isOwned %} <img src="{% url webstatic "images/kgpg12.png" %}" alt="l" title="locked"/>{% endif %}</td>
                    <td class="desc">{{ c.getDate }}</td>                    
                </tr>
            {% endfor %}
            {% for c in i.screen %}
                <tr id="screen-{{ c.id }}">
                    <td class="action">
                        <img id="{{ c.id }}" src="{% url webstatic "images/folder_screen32.png" %}" alt="screen" title="{{ c.name }}"/>
                        <input type="checkbox" name="screen" id="{{ c.id }}">      
                    </td>
                    <td class="desc">{{ c.shortName2 }} {% if c.annotation_counter %}<img src="{% url webstatic "images/knotes16.png" %}" alt="a" title="annotation"/>{% endif %}{% if not c.isOwned %} <img src="{% url webstatic "images/kgpg12.png" %}" alt="l" title="locked"/>{% endif %}</td>
                    <td class="desc">{{ c.getDate }}</td>                    
                </tr>
            {% endfor %}
            {% for c in i.dataset %}
                <tr id="dataset-{{ c.id }}">
                    <td class="action">
                        <img id="{{ c.id }}" src="{% url webstatic "images/folder_image32.png" %}" alt="dataset" title="{{ c.name }}"/>
                        <input type="checkbox" name="dataset" id="{{ c.id }}">      
                    </td>
                    <td class="desc">{{ c.shortName2 }} {% if c.annotation_counter %}<img src="{% url webstatic "images/knotes16.png" %}" alt="a" title="annotation"/>{% endif %}{% if not c.isOwned %} <img src="{% url webstatic "images/kgpg12.png" %}" alt="l" title="locked"/>{% endif %}</td>
                    <td class="desc">{{ c.getDate }}</td>                    
                </tr>
            {% endfor %}
            {% for c in i.plate %}
                <tr id="plate-{{ c.id }}">
                    <td class="action">
                        <img id="{{ c.id }}" src="{% url webstatic "images/folder_plate32.png" %}" alt="plate" title="{{ c.name }}"/>
                        <input type="checkbox" name="plate" id="{{ c.id }}">      
                    </td>
                    <td class="desc">{{ c.shortName2 }} {% if c.annotation_counter %}<img src="{% url webstatic "images/knotes16.png" %}" alt="a" title="annotation"/>{% endif %}{% if not c.isOwned %} <img src="{% url webstatic "images/kgpg12.png" %}" alt="l" title="locked"/>{% endif %}</td>
                    <td class="desc">{{ c.getDate }}</td>                    
                </tr>
            {% endfor %}
            {% for c in i.image %}
                <tr id="image-{{ c.id }}">
                    <td class="action">
                        <img id="{{ c.id }}" src="{% url render_thumbnail_resize 32 c.id  %}" alt="image" title="{{ c.name }}"/>
                        <input type="checkbox" name="image" id="{{ c.id }}">      
                    </td>
                    <td class="desc">{{ c.shortName2 }} {% if c.annotation_counter %}<img src="{% url webstatic "images/knotes16.png" %}" alt="a" title="annotation"/>{% endif %}{% if not c.isOwned %} <img src="{% url webstatic "images/kgpg12.png" %}" alt="l" title="locked"/>{% endif %}</td>
                    <td class="desc">{{ c.getDate }}</td>                    
                </tr>
            {% endfor %}
            {% endfor %}
            </tbody>
        </table>
        
        {% else %}
            <p>{% trans "No data." %}</p>
        {% endif %}

        {% if manager.c_size %}<div>
            <p>{% trans "Legend" %}: <img src="{% url webstatic "images/folder16.png" %}" title="Project" alt="project"/> - {% trans "Project" %}; <img src="{% url webstatic "images/folder_image16.png" %}" title="Dataset" alt="dataset"/> - {% trans "Dataset" %}; <img src="{% url webstatic "images/folder_screen16.png" %}" title="Screen" alt="screen"/> - {% trans "Screen" %}; <img src="{% url webstatic "images/folder_plate16.png" %}" title="Plate" alt="plate"/> - {% trans "Plate" %};</p>
        </div>{% endif %}

        {% include "omeroweb/history_paging.html" %}
        
    </div>
    
