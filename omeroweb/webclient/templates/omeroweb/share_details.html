{% extends "omeroweb/base_share.html" %}
{% load markup %}
{% load custom_tags %}
{% load wikitags %}

{% block link %}
    <link rel="stylesheet" href="{% get_webclient_static_url %}/css/images.css" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% get_webclient_static_url %}/css/share.css" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% get_webclient_static_url %}/css/googiespell.css" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% get_webclient_static_url %}/css/slider.css" type="text/css" media="screen"/>
{% endblock %}

{% block jscript %}
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/jquery_1.2.6.js"></script>
    
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/googiespell/AJS.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/googiespell/googiespell.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/googiespell/cookiesupport.js"></script>
{% endblock %}

{% block script %}
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/menu.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/blitzcon.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/popup.js"></script>
    
    <script type="text/javascript">
        $(document).ready(function(){
            
            $("div#share_content").html('<img src="{% get_webclient_static_url %}/images/tree/spinner.gif"/>');
            $("div#share_content").load("{% get_webclient_root_url %}/share_content/{{ share.share.id }}/");
            
        });
    </script>
{% endblock %}

{% block center %}
    
    <h1>Hi
        {% for m in share.membersInShare %}
            <a href="mailto:{{ m.email }}">{{ m.getFullName }}</a>,
        {% endfor %} 
        {{ share.share.details.getOwner }} would like to {% if share.projectInShare or share.datasetInShare or share.imageInShare %}share{% else %}discuss{% endif %} below content. <a href="{% get_webclient_root_url %}/share/edit/{{ share.share.id }}/"><img src="{% get_webclient_static_url %}/images/color_line16.png" alt="e" title="edit"/></a></h1>
    <div id="share_content"></div>
    <div class="clear"> </div>
    
    <h2>Details: 
        {% if share.share.active %}ACTIVE{% else %}NOT ACTIVE{% endif %}. Starts: {{ share.share.getStartDate }}, Expires: {{ share.share.getExpiretionDate }}
    </h2>
    
    {% if share.share.isOwned %}
        <div id="comment_wrapper_rev">
        <div id="comment_rev">
            <div class="head"><a href="mailto:{{ share.share.details.owner.email.val }}">{{ share.share.getOwner }}</a> posted comment on {{ share.share.getStartDate }}</div>
            <div class="body">{{ share.share.message|wikify|safe|linebreaks }}</div>
            <div class="footer"></div>
        </div>
        <div class="photo"><img src="{% get_webclient_root_url %}/userphoto/{{ share.share.details.owner.id.val }}/" alt="{{ share.share.getOwner }}" title="{{ share.share.getOwner }}" width="40" height="40" /></div>
        </div>
    {% else %}
        <div id="comment_wrapper">
        <div class="photo"><img src="{% get_webclient_root_url %}/userphoto/{{ share.share.details.owner.id.val }}/" alt="{{ share.share.getOwner }}" title="{{ share.share.getOwner }}" width="40" height="40" /></div>
        <div id="comment">
            <div class="head"><a href="mailto:{{ share.share.details.owner.email.val }}">{{ share.share.details.getOwner }}</a> posted comment on {{ share.share.getStartDate }}</div>
            <div class="body">{{ share.share.message|wikify|safe|linebreaks }}</div>
            <div class="footer"></div>
        </div>
        </div>
    {% endif %}
    <div class="clear"></div>
    <br/>
    
    {% if share.cmSize %}
        {% for cm in share.comments %}
            {% if cm.isOwned %}
                <div id="comment_wrapper_rev">
                <div id="comment_rev">
                    <div class="head"><a href="mailto:{{ cm.details.owner.email.val }}">{{ cm.getOwner }}</a> posted comment on {{ cm.creationEventDate }}</div>
                    <div class="body">{{ cm.textValue|wikify|safe|linebreaks }}</div>
                    <div class="footer"></div>
                </div>
                <div class="photo"><img src="{% get_webclient_root_url %}/userphoto/{{ cm.details.owner.id.val }}/" alt="{{ cm.getOwner }}" title="{{ cm.getOwner }}" width="40" height="40" /></div>
                </div>
                <div class="clear"></div>
                <br/>
            {% else %}
                <div id="comment_wrapper">
                <div class="photo"><img src="{% get_webclient_root_url %}/userphoto/{{ cm.details.owner.id.val }}/" alt="{{ cm.getOwner }}" title="{{ cm.getOwner }}" width="40" height="40" /></div>
                <div id="comment">
                    <div class="head"><a href="mailto:{{ cm.details.owner.email.val }}">{{ cm.getOwner }}</a> - {{ cm.creationEventDate }}</div>
                    <div class="body">{{ cm.textValue|wikify|safe|linebreaks }}</div>
                    <div class="footer"></div>
                </div>
                </div>
                <div class="clear"></div>
                <br/>
            {% endif %}
            
        {% endfor %}
        <div class="comment_bottom"> </div>

    {% endif %}

    <h1>Leave a Reply</h1>
    <div>
        <form action="{% get_webclient_root_url %}/share/comment/{{ share.share.id }}/" method="post">
            <table>
            {% for field in form %}
                <tr>
                    <td>{{ field }}</td><td>{% if field.errors %}{{ field.errors }}{% endif %}<br/>{{ field.help_text }}</td>
                </tr>
            {% endfor %}
            </table>
        <input type="submit" value="Post" />
        </form>
        <script type="text/javascript">
            var googie_spell = new GoogieSpell("static_core/googiespell/", "/webclient/spellchecker/?lang=");
            googie_spell.decorateTextarea("id_comment", null, "600px");
        </script>
    </div>

{% endblock %}
