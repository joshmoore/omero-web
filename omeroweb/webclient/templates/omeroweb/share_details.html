{% extends "omeroweb/base_share.html" %}
{% load i18n %}
{% load markup %}
{% load custom_tags %}
{% load wikitags %}

{% block link %}
    <link rel="stylesheet" href="{% url webstatic "css/images.css" %}" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% url webstatic "css/share.css" %}" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% url webstatic "css/googiespell.css" %}" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% url webstatic "css/slider.css" %}" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% url webstatic "css/tooltip.css" %}" type="text/css" media="screen"/>
{% endblock %}

{% block jscript %}
    <script type="text/javascript" src="{% url webstatic "javascript/jquery_1.2.6.js" %}"></script>
    
    <script type="text/javascript" src="{% url webstatic "javascript/jquery.tooltip.js" %}"></script>
    <script type="text/javascript" src="{% url webstatic "javascript/jquery.dimensions.js" %}"></script>
    <script type="text/javascript" src="{% url webstatic "javascript/jquery.bgiframe.js" %}"></script>
    <script type="text/javascript" src="{% url webstatic "javascript/jquery.delegate.js" %}"></script>
    
    <script type="text/javascript" src="{% url webstatic "javascript/googiespell/AJS.js" %}"></script>
    <script type="text/javascript" src="{% url webstatic "javascript/googiespell/googiespell.js" %}"></script>
    <script type="text/javascript" src="{% url webstatic "javascript/googiespell/cookiesupport.js" %}"></script>
{% endblock %}

{% block script %}
    <script type="text/javascript" src="{% url webstatic "javascript/menu.js" %}"></script>   
    
    {% ifequal share.share.getShareType "Share" %}
    <script type="text/javascript">
        $(document).ready(function(){
            
            $("div#share_content").html('<p>Loading content... please wait <img src ="{% url webstatic "images/tree/spinner.gif" %}"/></p>');
            {% if share.share.isOwned %}
                $("div#share_content").load("{% url load_share_owner_content share.share.id %}");
            {% else %}
                $("div#share_content").load("{% url load_share_content share.share.id %}");
            {% endif %}
        });
    </script>
    {% endifequal %}
    <script type="text/javascript">
        $(function() {
            $("#markup_c").tooltip({ 
                track: true, 
                delay: 0, 
                showURL: false, 
                opacity: 1, 
                fixPNG: true, 
                showBody: " - ", 
                top: -15, 
                left: 5 
            });
        });
    </script>
{% endblock %}

{% block center %}
    <h2>{% trans "Status" %}: 
        {% if share.share.active %}{% trans "ACTIVE" %}{% else %}{% trans "NOT ACTIVE" %}{% endif %}. {% trans "Starts" %}: {{ share.share.getStartDate|date:"Y m d H:i:s" }}, {% trans "Expires" %}: {% if share.share.getExpirationDate %}{{ share.share.getExpirationDate|date:"Y m d H:i:s" }}{% else %}{% trans "never" %}{% endif %}
    </h2>
    
    <h1>Hi, 
        {% for m in share.allInShare %}
            {{ m.getFullName }},
        {% endfor %} <br/>
        {{ share.share.getShareOwnerFullName }} {% trans "would like to" %} {{ share.share.getShareType|lower }} {% trans "with you" %}:
    </h1>
    
    {% ifequal share.share.getShareType "Share" %}<div id="share_content"></div>{% endifequal %}
    <div class="clear"> </div>
    
    {% if share.share.isOwned %}
        <div id="comment_wrapper">
        <div id="comment">
            <div class="head">{{ share.share.getShareOwnerFullName }} {% trans "posted comment at" %} {{ share.share.getStartDate|date:"Y m d H:i:s" }}</div>
            <div class="body">{{ share.share.message|sharewikify|safe|linebreaks }}</div>
            <div class="footer"></div>
        </div>
        <div class="photo"><img src="{% url load_photo share.share.owner.id.val %}" alt="{{ share.share.getShareOwnerFullName }}" title="{{ share.share.getShareOwnerFullName }}" width="40" height="40" /></div>
        </div>
    {% else %}
        <div id="comment_wrapper_rev">
        <div id="comment_rev">
            <div class="head">{{ share.share.getShareOwnerFullName }} {% trans "posted comment at" %} {{ share.share.getStartDate|date:"Y m d H:i:s" }}</div>
            <div class="body">{{ share.share.message|sharewikify|safe|linebreaks }}</div>
            <div class="footer"></div>
        </div>
        <div class="photo"><img src="{% url load_photo share.share.owner.id.val %}" alt="{{ share.share.getShareOwnerFullName }}" title="{{ share.share.getShareOwnerFullName }}" width="40" height="40" /></div>
        </div>
    {% endif %}
    <div class="clear"></div>
    <br/>
    
    {% if share.cmSize %}
        {% for cm in share.comments %}
            {% if cm.isOwned %}
                <div id="comment_wrapper">
                <div id="comment">
                    <div class="head">{{ cm.getOwnerFullName }} {% trans "posted comment at" %} {{ cm.creationEventDate|date:"Y m d H:i:s" }}</div>
                    <div class="body">{{ cm.textValue|sharewikify|safe|linebreaks }}</div>
                    <div class="footer"></div>
                </div>
                <div class="photo"><img src="{% url load_photo cm.details.owner.id.val %}" alt="{{ cm.getOwnerFullName }}" title="{{ cm.getOwnerFullName }}" width="40" height="40" /></div>
                </div>
                <div class="clear"></div>
                <br/>
            {% else %}
                <div id="comment_wrapper_rev">
                <div id="comment_rev">
                    <div class="head">{{ cm.getOwnerFullName }} {% trans "posted comment at" %} {{ cm.creationEventDate|date:"Y m d H:i:s" }}</div>
                    <div class="body">{{ cm.textValue|sharewikify|safe|linebreaks }}</div>
                    <div class="footer"></div>
                </div>
                <div class="photo"><img src="{% url load_photo cm.details.owner.id.val %}" alt="{{ cm.getOwnerFullName }}" title="{{ cm.getOwnerFullName }}" width="40" height="40" /></div>
                </div>
                <div class="clear"></div>
                <br/>
            {% endif %}
            
        {% endfor %}
        <div class="comment_bottom"> </div>

    {% endif %}


    <h1>{% trans "Leave a Reply" %}</h1>
    {% if form %}
    <div>
        <form action="{% url manage_share "comment" share.share.id %}" method="post">
            <table>
            {% for field in form %}
                <tr>
                    <td>{{ field }}</td><td>{% if field.errors %}{{ field.errors }}{% endif %}<br/>{{ field.help_text|safe }}</td>
                </tr>
            {% endfor %}
            </table>
        <input type="submit" value="{% trans 'Post' %}" />
        </form>
        <script type="text/javascript">
            var googie_spell = new GoogieSpell("static_core/googiespell/", "{% url spellchecker %}"+"?lang=");
            googie_spell.decorateTextarea("id_comment", null, "600px");
        </script>
    </div>
    {% else %}
    <div>Commenting is no longer available, because share expired.</div>
    {% endif %}
    
{% endblock %}
