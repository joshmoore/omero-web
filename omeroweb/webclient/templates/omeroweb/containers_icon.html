{% extends "omeroweb/base.html" %}
{% load markup %}
{% load custom_tags %}
{% load wikitags %}

{% block link %}
    <link rel="stylesheet" href="{% get_webclient_static_url %}/css/annotation.css" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% get_webclient_static_url %}/css/thickbox.css" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% get_webclient_static_url %}/css/slider.css" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% get_webclient_static_url %}/css/tree.css" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% get_webclient_static_url %}/css/googiespell.css" type="text/css" media="screen"/>
{% endblock %}

{% block jscript %}
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/jquery_1.2.6.js"></script>
    
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/jquery.quicksearch.js"></script>
    
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/ui/ui.core.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/ui/ui.draggable.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/ui/ui.droppable.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/ui/ui.resizable.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/ui/ui.slider.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/ui/effects.core.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/ui/effects.highlight.js"></script>
    
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/googiespell/AJS.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/googiespell/googiespell.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/googiespell/cookiesupport.js"></script>
    
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/thickbox/thickbox.js"></script>
{% endblock %}

{% block script %}
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/menu.js"></script> 
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/basket.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/slider.js"></script> 
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/blitzcon.js"></script>
    <script>
        $(document).ready(function(){
            $('ul#products li.product').quicksearch({
                attached: "div#view",
                position: "before",
                stripeRowClass: null,
                labelText: 'Filter:',
                inputText: '...',
                loaderImg: '/webclient/static/images/tree/spinner.gif',
            });
            
            $("a.loadData").click(function()
            {
                $("div#hierarchy").html('<img src="{% get_webclient_static_url %}/images/tree/spinner.gif"/>');
                $("div#hierarchy").load(
                    {% if manager.project or manager.dataset %}
                        {% if manager.dataset %}
                            "{% get_webclient_root_url %}/hierarchy/dataset/{{ manager.dataset.id }}/", 
                        {% endif %}
                        {% if manager.project %}
                            "{% get_webclient_root_url %}/hierarchy/project/{{ manager.project.id }}/", 
                        {% endif %}
                    {% else %}
                        "{% get_webclient_root_url %}/hierarchy/", 
                    {% endif %}
                    function() {  
                        $("a.loadData").remove();                        
                    });
                return false; 
            });
            $("a.loadAnnotation").click(function()
            {
                $("div#annotation").html('<img src="{% get_webclient_static_url %}/images/tree/spinner.gif"/>');
                $("div#annotation").load(
                    {% if manager.dataset %}
                        "{% get_webclient_root_url %}/annotations/dataset/{{ manager.dataset.id }}/?url={{ url }}", 
                    {% endif %}
                    {% if manager.project %}
                        "{% get_webclient_root_url %}/annotations/project/{{ manager.project.id }}/?url={{ url }}", 
                    {% endif %}
                    function() {  
                        $("a.loadAnnotation").remove();                        
                    });
                return false; 
            });
        });
    </script>
{% endblock %}

{% block center %}

{% if form_users %}
<div class="box">
    {% for field in form_users %}{{ field.label_tag }} {{ field }}{% if field.errors %} {{ field.errors }} {% endif %} {{ field.help_text }}{% endfor %}
</div>
{% endif %}

{% if form_mygroups %}
<div class="box">&nbsp;
    {% for field in form_mygroups %}{{ field.label_tag }} {{ field }}{% if field.errors %} {{ field.errors }} {% endif %} {{ field.help_text }}{% endfor %}
</div>
{% endif %}

{% if manager.dataset %}
    <div class="dataset"><h1>Dataset: {{ manager.dataset.name }} <a href="{% get_webclient_root_url %}/action/edit/dataset/{{ manager.dataset.id }}/?url={{url}}"><img src="{% get_webclient_static_url %}/images/color_line16.png" alt="e" title="edit"/></a></h1>
        {{ manager.dataset.description|default_if_none:"no description"|wikify|safe|linebreaks }}
    </div>
    <div class="basket"><a href="#" onclick="toBasket('dataset', '{{ manager.dataset.id }}'); return false;">Add entire dataset to the basket <img src="{% get_webclient_static_url %}/images/basket12.png" alt="b" title="basket"/></a></div>
{% else %}
    {% if manager.project %}
        <div class="project"><h1>Project: {{ manager.project.name }} <a href="{% get_webclient_root_url %}/action/edit/project/{{ manager.project.id }}/?url={{url}}"><img src="{% get_webclient_static_url %}/images/color_line16.png" alt="e" title="edit"/></a> </h1>
            {{ manager.project.description|default_if_none:"no description"|wikify|safe|linebreaks }}
        </div>
        <div class="basket"><a href="#" onclick="toBasket('project', '{{ manager.project.id }}'); return false;">Add entire project to the basket <img src="{% get_webclient_static_url %}/images/basket12.png" alt="b" title="basket"/></a></div>
    {% endif %}
{% endif %}

<div class="clear"></div>

{% if manager.c_size or manager.c_mg_size %}
    {% if manager.c_size %}
        {% if manager.experimenter %}
            <h1>{{ manager.experimenter.getFullName }}'s ({{ manager.c_size }} items):</h1>
        {% else %}
            <h1>My data ({{ manager.c_size }} items):</h1>
        {% endif %}
    {% endif %}
    {% if manager.c_mg_size %}
        {% if manager.myGroup %}
            <h1>{{ manager.myGroup.name }}'s data ({{ manager.c_mg_size }} items):</h1>
        {% endif %}
    {% endif %}
{% else %}
    {% ifequal nav.menu 'mydata' %}
        <h1>My data (no item):</h1>
    {% else %}
        <h1>Data (no item):</h1>
    {% endifequal %}
{% endif %}

<div id="view"> 
{% ifequal nav.menu "mydata" %}
        | View <a href="{% get_webclient_root_url %}/mydata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}{% if manager.dataset.id %}dataset/{{manager.dataset.id}}/{% endif %}?view=table"><img src="{% get_webclient_static_url %}/images/view_detailed16.jpg" alt="details" title="details"/></a> <a href="{% get_webclient_root_url %}/mydata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}{% if manager.dataset.id %}dataset/{{manager.dataset.id}}/{% endif %}?view=icon"><img src="{% get_webclient_static_url %}/images/view_icon16.jpg" alt="icon" title="icon"/></a> <a href="{% get_webclient_root_url %}/mydata/?view=tree"><img src="{% get_webclient_static_url %}/images/view_tree16.jpg" alt="tree" title="tree"/></a> |
{% else %}
    {% ifequal nav.menu "collaboration" %}
            {% ifequal nav.whos "share" %} | View <a href="{% get_webclient_root_url %}/share/?view=table"><img src="{% get_webclient_static_url %}/images/view_detailed16.jpg" alt="table" title="table"/></a> <a href="{% get_webclient_root_url %}/share/?view=icon"><img src="{% get_webclient_static_url %}/images/view_icon16.jpg" alt="icon" title="icon"/></a> |
            {% endifequal %}
            {% ifequal nav.whos "userdata" %} | View <a href="{% get_webclient_root_url %}/userdata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}{% if manager.dataset.id %}dataset/{{manager.dataset.id}}/{% endif %}?view=table"><img src="{% get_webclient_static_url %}/images/view_detailed16.jpg" alt="details" title="details"/></a> <a href="{% get_webclient_root_url %}/userdata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}{% if manager.dataset.id %}dataset/{{manager.dataset.id}}/{% endif %}?view=icon"><img src="{% get_webclient_static_url %}/images/view_icon16.jpg" alt="icon" title="icon"/></a> <a href="{% get_webclient_root_url %}/userdata/?view=tree"><img src="{% get_webclient_static_url %}/images/view_tree16.jpg" alt="tree" title="tree"/></a> |
            {% endifequal %}
            {% ifequal nav.whos "groupdata" %} | View <a href="{% get_webclient_root_url %}/groupdata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}{% if manager.dataset.id %}dataset/{{manager.dataset.id}}/{% endif %}?view=table"><img src="{% get_webclient_static_url %}/images/view_detailed16.jpg" alt="details" title="details"/></a> <a href="{% get_webclient_root_url %}/groupdata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}{% if manager.dataset.id %}dataset/{{manager.dataset.id}}/{% endif %}?view=icon"><img src="{% get_webclient_static_url %}/images/view_icon16.jpg" alt="icon" title="icon"/></a> <a href="{% get_webclient_root_url %}/groupdata/?view=tree"><img src="{% get_webclient_static_url %}/images/view_tree16.jpg" alt="tree" title="tree"/></a> |
            {% endifequal %}
            
    {% endifequal %}
{% endifequal %}
{% if not manager.image %}
    {% if manager.project %}
        New <a href="{% get_webclient_root_url %}/action/new/project/{{ manager.project.id }}/?url={{url}}"><img src="{% get_webclient_static_url %}/images/window_new16.jpg" alt="new" title="new" /></a> | 
    {% else %}
        {% if not manager.dataset %}
            New <a href="{% get_webclient_root_url %}/action/new/?url={{url}}"><img src="{% get_webclient_static_url %}/images/window_new16.jpg" alt="new" title="new" /></a> | 
        {% endif %}
    {% endif %}
{% endif %}
</div>

<div class="slider">
    <div class="slider_products"> 
        <div class="slider_text">Zoom:</div>
        <div class='small_label'></div> 
        <div class='slider_bar'> 
            <div id="slider_callout"></div> 
            <div id='slider1_handle' class='slider_handle'></div> 
        </div> 
        <div class='large_label'></div> 
    </div>
</div>

<div class="clear"> </div>

{% if not manager.c_mg_size and not manager.c_size %}
    <h1>No data.</h1>
{% else %}
    {% if manager.c_size %}
    <ul id="products">
        {% for c in manager.containers.projects %}
        <li class="product"><em>{{ c.name }}</em>
            {% ifnotequal c.details.owner.id.val eContext.context.userId %}<a href="{% get_webclient_root_url %}/userdata/project/{{ c.id }}/?filter=experimenter&experimenter={{ c.details.owner.id.val }}"><img id="{{ c.id }}" class="catzoom" src="{% get_webclient_static_url %}/images/folder64.png" title="{{ c.name }}" alt="project"/></a>{% else %}<a href="{% get_webclient_root_url %}/mydata/project/{{ c.id }}/?view=icon"><img id="{{ c.id }}" class="catzoom" src="{% get_webclient_static_url %}/images/folder64.png" title="{{ c.name }}" alt="project"/></a>{% endifnotequal %}<div class="center">{{ c.tinyName }}{% ifnotequal c.details.owner.id.val eContext.context.userId %}<img src="{% get_webclient_static_url %}/images/kgpg12.png" alt="l" title="locked"/>{% endifnotequal %}{% if c.countAnnotations %}<img src="{% get_webclient_static_url %}/images/knotes12.png" alt="a" title="annotation"/>{% endif %}</div>
        </li>
        {% endfor %}
        {% for c in manager.containers.datasets %}
        <li class="product"><em>{{ c.name }}</em>
            {% ifnotequal c.details.owner.id.val eContext.context.userId %}<a href="{% get_webclient_root_url %}/userdata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}dataset/{{ c.id }}/?filter=experimenter&experimenter={{ c.details.owner.id.val }}"><img id="{{ c.id }}" class="catzoom" src="{% get_webclient_static_url %}/images/folder_image64.png" alt="dataset" title="{{ c.name }}"/></a>{% else %}<a href="{% get_webclient_root_url %}/mydata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}dataset/{{ c.id }}/?view=icon"><img id="{{ c.id }}" class="catzoom" src="{% get_webclient_static_url %}/images/folder_image64.png" alt="dataset" title="{{ c.name }}"/></a>{% endifnotequal %}<div class="center">{{ c.tinyName }}{% ifnotequal c.details.owner.id.val eContext.context.userId %}<img src="{% get_webclient_static_url %}/images/kgpg12.png" alt="l" title="locked"/>{% endifnotequal %}{% if c.countAnnotations %}<img src="{% get_webclient_static_url %}/images/knotes12.png" alt="a" title="annotation"/>{% endif %}</div>
        </li>
        {% endfor %}
        {% for c in manager.containers.images %}
        <li class="product"><em>{{ c.name }}</em>
            {% ifnotequal c.details.owner.id.val eContext.context.userId %}
            <a href="{% get_webclient_root_url %}/userdata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}{% if manager.dataset.id %}dataset/{{manager.dataset.id}}/{% endif %}image/{{ c.id }}/"><img id="{{ c.id }}" class="imgzoom" src="{% get_webclient_root_url %}/render_thumbnail/{{ c.id }}/" alt="image" title="{{ c.name }}"/></a>{% else %}<a href="{% get_webclient_root_url %}/mydata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}{% if manager.dataset.id %}dataset/{{manager.dataset.id}}/{% endif %}image/{{ c.id }}/"><img id="{{ c.id }}" class="imgzoom" src="{% get_webclient_root_url %}/render_thumbnail/{{ c.id }}/" alt="image" title="{{ c.name }}"/></a>{% endifnotequal %}<div class="center">{{ c.tinyName }}</div><div class="center"><a href="#" onclick="popup('','_blank',{{ c.id }}); return false;"><img src="{% get_webclient_static_url %}/images/kview12.png" alt="v" title="view"/></a><a href="{% get_webclient_root_url %}/image_zoom/{{ c.id }}/?keepThis=true&TB_iframe=true&height=500&width=760" alt="{{ c.name }}" class="thickbox" rel="gallery-omero" title="{{ c.name }} by {{ c.getOwner }} ({{ c.details.group.name.val }} {{ c.details.permissions }})"><img src="{% get_webclient_static_url %}/images/kpresenter12.png" alt="p" title="presentation"/></a>{% ifnotequal c.details.owner.id.val eContext.context.userId %} <img src="{% get_webclient_static_url %}/images/kgpg12.png" alt="l" title="locked"/>{% else %}<a href="{% get_webclient_root_url %}/action/edit/image/{{ c.id }}/?url={{url}}"><img src="{% get_webclient_static_url %}/images/color_line12.png" alt="e" title="edit"/></a><a href="#" onclick="toBasket('image', '{{ c.id }}'); return false;"><img src="{% get_webclient_static_url %}/images/basket12.png" alt="b" title="basket"/></a>{% endifnotequal %}{% if c.countAnnotations %}<img src="{% get_webclient_static_url %}/images/knotes12.png" alt="a" title="annotation"/>{% endif %}</div>
        </li>
        {% endfor %}
    </ul>
    {% endif %}

    {% if manager.c_mg_size %}
    <ul id="products">
    {% for k,v in manager.containersMyGroups.iteritems %}
        <li class="clear"> </li>
        <li class="owner_name">{{ v.name|safe }}</li>
            {% for c in v.projects %}
             <li class="product"><em>{{ c.name }}</em>
                 <a href="{% get_webclient_root_url %}/groupdata/project/{{ c.id }}/?filter=group&group={{ c.details.group.id.val }}"><img id="{{ c.id }}" class="catzoom" src="{% get_webclient_static_url %}/images/folder64.png" title="{{ c.name }}" alt="project"/></a><div class="center">{{ c.tinyName }}</div><div class="center">{% ifnotequal c.details.owner.id.val eContext.context.userId %}<img src="{% get_webclient_static_url %}/images/kgpg12.png" alt="l" title="locked"/>{% endifnotequal %}{% if c.countAnnotations %}<img src="{% get_webclient_static_url %}/images/knotes12.png" alt="a" title="annotation"/>{% endif %}</div>
             </li>
            {% endfor %}
            {% for c in v.datasets %}
            <li class="product"><em>{{ c.name }}</em>
                <a href="{% get_webclient_root_url %}/groupdata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}dataset/{{ c.id }}/?filter=group&group={{ c.details.group.id.val }}"><img id="{{ c.id }}" class="catzoom" src="{% get_webclient_static_url %}/images/folder_image64.png" alt="dataset" title="{{ c.name }}"/></a><div class="center">{{ c.tinyName }}</div><div class="center">{% ifnotequal c.details.owner.id.val eContext.context.userId %}<img src="{% get_webclient_static_url %}/images/kgpg12.png" alt="l" title="locked"/>{% endifnotequal %}{% if c.countAnnotations %}<img src="{% get_webclient_static_url %}/images/knotes12.png" alt="a" title="annotation"/>{% endif %}</div>
            </li>
            {% endfor %}
            {% for c in v.images %}
            <li class="product"><em>{{ c.name }}</em>
                <a href="{% get_webclient_root_url %}/groupdata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}{% if manager.dataset %}dataset/{{manager.dataset.id}}/{% endif %}image/{{ c.id }}/"><img id="{{ c.id }}" class="imgzoom" src="{% get_webclient_root_url %}/render_thumbnail/{{ c.id }}/" alt="image" title="{{ c.name }}"/></a><div class="center">{{ c.tinyName }}</div><div class="center"><a href="#" onclick="popup('','_blank',{{ c.id }}); return false;"><img src="{% get_webclient_static_url %}/images/kview12.png" alt="v" title="view"/></a><a href="{% get_webclient_root_url %}/image_zoom/{{ c.id }}/?keepThis=true&TB_iframe=true&height=500&width=760" alt="{{ c.name }}" class="thickbox" rel="gallery-omero" title="{{ c.name }} by {{ c.getOwner }} ({{ c.details.group.name.val }} {{ c.details.permissions }})"><img src="{% get_webclient_static_url %}/images/kpresenter12.png" alt="p" title="presentation"/></a>{% ifnotequal c.details.owner.id.val eContext.context.userId %} <img src="{% get_webclient_static_url %}/images/kgpg12.png" alt="l" title="locked"/>{% else %}<a href="{% get_webclient_root_url %}/action/edit/image/{{ c.id }}/?url={{url}}"><img src="{% get_webclient_static_url %}/images/color_line12.png" alt="e" title="edit"/></a><a href="#" onclick="toBasket('image', '{{ c.id }}'); return false;"><img src="{% get_webclient_static_url %}/images/basket12.png" alt="b" title="basket"/></a>{% endifnotequal %}{% if c.countAnnotations %}<img src="{% get_webclient_static_url %}/images/knotes12.png" alt="a" title="annotation"/>{% endif %}</div>
            </li>
            {% endfor %}
    {% endfor %}
    </ul>
    {% endif %}
{% endif %}

<div class="clear"> </div>

{% if manager.project or manager.dataset %}
<h1>More:</h1>

<div><a href="#" class="loadData">Show the hierarchy structure.</a></div>
<div id="hierarchy"> </div>

<div><a href="#" class="loadAnnotation">Show annotations.</a></div>
{% endif %}
{% endblock %}

