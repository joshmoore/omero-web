{% extends "omeroweb/base_share.html" %}
{% load markup %}
{% load custom_tags %}
{% load wikitags %}

{% block link %}
    <link rel="stylesheet" href="{% get_webclient_static_url %}/css/share.css" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% get_webclient_static_url %}/css/datepicker.css" type="text/css" />
    <link rel="stylesheet" href="{% get_webclient_static_url %}/css/googiespell.css" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% get_webclient_static_url %}/css/tooltip.css" type="text/css" media="screen"/>
{% endblock %}

{% block jscript %}
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/jquery_1.2.6.js"></script>
    
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/jquery.tooltip.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/jquery.dimensions.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/jquery.bgiframe.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/jquery.delegate.js"></script>
    
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/ui/ui.core.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/ui/ui.datepicker.js"></script>
    
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/googiespell/AJS.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/googiespell/googiespell.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/googiespell/cookiesupport.js"></script>
{% endblock %}

{% block script %}
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/menu.js"></script> 

    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/blitzcon.js"></script>
    <script>
      $(document).ready(function(){
          $('#id_expiration').datepicker({firstDay: 1, dateFormat: 'yy-mm-dd'});
          
      });
    </script>
    
    {% ifequal share.share.getShareType "Share" %}
    <script>
      $(document).ready(function(){
          
          $("div#share_content").html('<p>Loading content... please wait <img src="{% get_webclient_static_url %}/images/tree/spinner.gif"/></p>');
          $("div#share_content").load("{% get_webclient_root_url %}/share_content/{{ share.share.id }}/");
          
          $('#id_expiration').datepicker({firstDay: 1, dateFormat: 'yy-mm-dd'});
      });
    </script>
    {% endifequal %}
    
    <script type="text/javascript">
        $(function() {
            $("#markup_c, #enable, #expire").tooltip({ 
                track: true, 
                delay: 0, 
                showURL: false, 
                opacity: 1, 
                fixPNG: true, 
                showBody: " - ", 
                top: -15, 
                left: 5 
            });
        });
    </script>
    
{% endblock %}

{% block center %}

<h1>Edit {{ share.share.getShareType|lower }}:</h1>

<div id="share_content"></div>
<div class="clear"> </div>

    <div>
        <form action="{% get_webclient_root_url %}/share/save/{{ share.share.id }}/" method="post">
            <table>
            {% for field in form %}
                <tr><th>{{ field.label_tag }}{% if field.field.required %}*{% endif %}</th>
                    <td>{{ field }}</td><td>{% if field.errors %}{{ field.errors }}{% endif %}<br/>{{ field.help_text|safe }}</td>
                </tr>
            {% endfor %}
                <tr><td colspan="2"><input type="submit" value="Save" /></td></tr>
            </table>
        </form>
        <script type="text/javascript">
            var googie_spell = new GoogieSpell("static_core/googiespell/", "/webclient/spellchecker/?lang=");
            googie_spell.decorateTextarea("id_message", null, "600px");
        </script>
    </div>

    <div>
        <h1>Manage comments:</h1>
        {% if share.cmSize %}
            {% for cm in share.comments %}
                {% if cm.isOwned %}
                    <div id="comment_wrapper">
                    <div id="comment">
                        <div class="head">{{ cm.getOwner }} posted comment at {{ cm.creationEventDate|date:" H:i:s d M Y" }} {% if cm.isEditable %}<a href="{% get_webclient_root_url %}/action/edit/comment/{{ cm.id }}/?url={{ url }}"><img src="{% get_webclient_static_url %}/images/color_line16.png" alt="e" title="edit"/></a>{% endif %}</div>
                        <div class="body">{{ cm.textValue|sharewikify|safe|linebreaks }}</div>
                        <div class="footer"></div>
                    </div>
                    <div class="photo"><img src="{% get_webclient_root_url %}/userphoto/{{ cm.details.owner.id.val }}/" alt="{{ cm.getOwner }}" title="{{ cm.getOwner }}" width="40" height="40" /></div>
                    </div>
                    <div class="clear"></div>
                    <br/>
                {% else %}
                    <div id="comment_wrapper_rev">
                    <div id="comment_rev">
                        <div class="head">{{ cm.getOwner }} posted comment at {{ cm.creationEventDate|date:" H:i:s d M Y" }} {% if cm.isEditable %}<a href="{% get_webclient_root_url %}/action/edit/comment/{{ cm.id }}/?url={{ url }}"><img src="{% get_webclient_static_url %}/images/color_line16.png" alt="e" title="edit"/></a>{% endif %}</div>
                        <div class="body">{{ cm.textValue|sharewikify|safe|linebreaks }}</div>
                        <div class="footer"></div>
                    </div>
                    <div class="photo"><img src="{% get_webclient_root_url %}/userphoto/{{ cm.details.owner.id.val }}/" alt="{{ cm.getOwner }}" title="{{ cm.getOwner }}" width="40" height="40" /></div>
                    </div>
                    <div class="clear"></div>
                    <br/>
                {% endif %}
            {% endfor %}
            <div class="comment_bottom"> </div>
        {% else %}
            No comments.
        {% endif %}
    </div>
{% endblock %}
