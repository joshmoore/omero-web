{% extends "omeroweb/base.html" %}
{% load markup %}
{% load custom_tags %}

{% block link %}
    <link rel="stylesheet" href="{% get_webclient_static_url %}/css/datepicker.css" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% get_webclient_static_url %}/css/thickbox.css" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% get_webclient_static_url %}/css/slider.css" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% get_webclient_static_url %}/css/tree.css" type="text/css" media="screen"/>
    <link rel="stylesheet" href="{% get_webclient_static_url %}/css/googiespell.css" type="text/css" media="screen"/>
{% endblock %}

{% block jscript %}
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/jquery_1.2.6.js"></script>
    
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/jquery.quicksearch.js"></script>
    
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/ui/ui.core.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/ui/ui.datepicker.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/ui/ui.draggable.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/ui/ui.droppable.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/ui/ui.resizable.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/ui/ui.slider.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/ui/effects.core.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/ui/effects.highlight.js"></script>
    
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/googiespell/AJS.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/googiespell/googiespell.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/googiespell/cookiesupport.js"></script>
    
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/thickbox/thickbox.js"></script>
{% endblock %}

{% block script %}
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/menu.js"></script> 
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/slider.js"></script> 
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/blitzcon.js"></script>
    <script type="text/javascript" src="{% get_webclient_static_url %}/javascript/basket.js"></script>
    <script>
      $(document).ready(function(){
          $('#dateperiodinput').datepicker({rangeSelect: true, firstDay: 1, dateFormat: 'yy-mm-dd', rangeSeparator: '_'});
          
          $('ul#products li.product').quicksearch({
              attached: "div.slider",
              position: "before",
              stripeRowClass: null,
              labelText: 'Filter:',
              inputText: 'search',
              loaderImg: '/webclient/static/images/tree/spinner.gif',
          });
        });
    </script>
{% endblock %}

{% block center %}
    <div class="project">
        <p>Searching feature enables you to search within the images, datasets and projects stored on the server. It supports single and multiple character wildcard searches. </p>
        <p>To perform a single character wildcard search use the <b>"?"</b> symbol. The single character wildcard search looks for terms that match that with the single character replaced. To perform a multiple character wildcard search use the <b>"*"</b> symbol. </p>
        
        <p>For example, to search for <i>"text"</i> or <i>"test"</i> you can use the search: <b>"te?t"
</b>. Multiple character wildcard searches looks for 0 or more characters. For example, to search for <i>"test"</i>, <i>"tests"</i> or <i>"tester"</i>, you can use the search: <b>"test*"</b>. You can also use the wildcard searches in the middle or the beginning of a term.</p>
        <p>Date range feature enables you to specify the start and end time of the created data. To select the range, clink on the field and pick start date and end date on the same calendar. If you want to change the date click on the field again the pick the range.</p>
        <p>Results are displayed as a table by default.</p>
    </div>
    <div class="clear"></div>
    
    <p>
    <form action="{% get_webclient_root_url %}/search/" method="GET">
        <table>
            <tr><th>Search for *:</th><td><input class="search" type="text" name="query" value="{{ controller.criteria.query }}" size="52"/></td></tr>
            <!--<tr><th>by date:</th><td><input type="text" id="dateinput" name="date" value="" size="15"/></td></tr>-->
            <tr><th>Date range:</th><td><input type="text" id="dateperiodinput" name="dateperiodinput" value="{{ controller.criteria.period }}" size="25"/></td></tr>
            <tr><th>In *:</th><td>
                <input  type="checkbox" name="image" {{ controller.criteria.image }} />image <input type="checkbox" name="dataset" {{ controller.criteria.dataset }} />dataset  <input type="checkbox" name="project" {{ controller.criteria.project }} />project
            </td></tr>
        </table>
        <input type="hidden" name="view" value="{{ nav.view }}" />
        <input type="submit" value="Search" /> <input type="button" value="Back" onClick="history.back()" />
    </form>
    </p>
    <div class="separate70"></div>
    
    {% if controller.resultsSize %}
    <div><h1>Results ({{ controller.resultsSize }} items):</h1></div>
    
    <div id="view"> | View <a href="{% get_webclient_root_url %}/search/?view=table{{ controller.url }}"><img src="{% get_webclient_static_url %}/images/view_detailed16.png" alt="details" title="details"/></a> <a href="{% get_webclient_root_url %}/search/?view=icon{{ controller.url }}"><img src="{% get_webclient_static_url %}/images/view_icon16.png" alt="icon" title="icon"/></a> | </div>

    
    <div class="slider">
        <div class="slider_products"> 
            <div class="slider_text">Zoom:</div>
            <div class='small_label'></div> 
            <div class='slider_bar'> 
                <div id="slider_callout"></div> 
                <div id='slider1_handle' class='slider_handle'></div> 
            </div> 
            <div class='large_label'></div> 
        </div>
    </div>
    <div class="clear"> </div>

    <ul id="products">
        {% for c in controller.projects %}
        <li class="product"><em>{{ c.name }}</em>
            {% if c.isOwned %}<a href="{% get_webclient_root_url %}/mydata/project/{{ c.id }}/?view=icon"><img id="{{ c.id }}" class="catzoom" src="{% get_webclient_static_url %}/images/folder64.png" title="{{ c.name }}" alt="project"/></a>{% else %}<a href="{% get_webclient_root_url %}/userdata/project/{{ c.id }}/?filter=experimenter&experimenter={{ c.details.owner.id.val }}"><img id="{{ c.id }}" class="catzoom" src="{% get_webclient_static_url %}/images/folder64.png" title="{{ c.name }}" alt="project"/></a>{% endif %}
            <div class="center">{{ c.tinyName }} [{{ c.countChild }}]</div>
            <div class="center">{% if c.countAnnotations %} <img src="{% get_webclient_static_url %}/images/knotes12.png" alt="a" title="annotation"/>{% endif %}{% if not c.isOwned %} <img src="{% get_webclient_static_url %}/images/kgpg12.png" alt="l" title="locked"/>{% endif %}</div>
        </li>
        {% endfor %}
        {% for c in controller.datasets %}
        <li class="product"><em>{{ c.name }}</em>
            {% if c.isOwned %}<a href="{% get_webclient_root_url %}/mydata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}dataset/{{ c.id }}/?view=icon"><img id="{{ c.id }}" class="catzoom" src="{% get_webclient_static_url %}/images/folder_image64.png" alt="dataset" title="{{ c.name }}"/></a>{% else %}<a href="{% get_webclient_root_url %}/userdata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}dataset/{{ c.id }}/?filter=experimenter&experimenter={{ c.details.owner.id.val }}"><img id="{{ c.id }}" class="catzoom" src="{% get_webclient_static_url %}/images/folder_image64.png" alt="dataset" title="{{ c.name }}"/></a>{% endif %}
            <div class="center">{{ c.tinyName }} [{{ c.countChild }}]</div>
            <div class="center">{% if c.countAnnotations %} <img src="{% get_webclient_static_url %}/images/knotes12.png" alt="a" title="annotation"/>{% endif %}{% if not c.isOwned %} <img src="{% get_webclient_static_url %}/images/kgpg12.png" alt="l" title="locked"/>{% endif %} <a href="#" onclick="copyToClipboard('dataset', '{{ c.id }}'); return false;"><img src="{% get_webclient_static_url %}/images/eclipse_copy_edit12.png" alt="c" title="copy"/></a></div>
        </li>
        {% endfor %}
        {% for c in controller.images %}
        <li class="product"><em>{{ c.name }}</em>
            {% if c.isOwned %}
            <a href="{% get_webclient_root_url %}/mydata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}{% if manager.dataset.id %}dataset/{{manager.dataset.id}}/{% endif %}image/{{ c.id }}/"><img id="{{ c.id }}" class="imgzoom" src="{% get_webclient_root_url %}/render_thumbnail/{{ c.id }}/" alt="image" title="{{ c.name }}"/></a>{% else %}<a href="{% get_webclient_root_url %}/userdata/{% if manager.project %}project/{{manager.project.id}}/{% endif %}{% if manager.dataset.id %}dataset/{{manager.dataset.id}}/{% endif %}image/{{ c.id }}/"><img id="{{ c.id }}" class="imgzoom" src="{% get_webclient_root_url %}/render_thumbnail/{{ c.id }}/" alt="image" title="{{ c.name }}"/></a>{% endif %}
            <div class="center">{{ c.tinyName }}{% if c.countAnnotations %} <img src="{% get_webclient_static_url %}/images/knotes12.png" alt="a" title="annotation"/>{% endif %}{% if not c.isOwned %} <img src="{% get_webclient_static_url %}/images/kgpg12.png" alt="l" title="locked"/>{% endif %}</div><div class="center"><a href="#" onclick="popup('','_blank',{{ c.id }}); return false;"><img src="{% get_webclient_static_url %}/images/kview12.png" alt="v" title="view"/></a> <a href="{% get_webclient_root_url %}/image_zoom/{{ c.id }}/?keepThis=true&TB_iframe=true&height=500&width=860" alt="{{ c.shortName }}" class="thickbox" rel="gallery-omero" title="{{ c.shortName }} by {{ c.getOwner }} ({{ c.details.group.name.val }} {{ c.details.permissions }})"><img src="{% get_webclient_static_url %}/images/kpresenter12.png" alt="p" title="presentation"/></a>{% if c.isOwned %} <a href="#" onclick="toBasket('image', '{{ c.id }}'); return false;"> <img src="{% get_webclient_static_url %}/images/basket12.png" alt="b" title="add to basket"/></a>{% endif %} <a href="#" onclick="copyToClipboard('image', '{{ c.id }}'); return false;"><img src="{% get_webclient_static_url %}/images/eclipse_copy_edit12.png" alt="c" title="copy"/></a></div>
        </li>
        {% endfor %}
    </ul>
    {% else %}
        <div>No results. Fill the form.</div>
    {% endif %}

{% endblock %}
